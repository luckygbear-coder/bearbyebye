<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ„›åƒç†Š</title>

  <!-- PWA / Icon è¨­å®š -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-512.png">
  <meta name="theme-color" content="#f4a63a">

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- å•Ÿå‹•ç•«é¢ï¼šé€²ä¾†æ™‚å…ˆçœ‹åˆ°ç†Šç†Šæ•´å¼µåœ– -->
  <div id="loading-screen">
    <img src="images/bear-loading-couplet.png" alt="æ„›åƒç†Šå•Ÿå‹•ç•«é¢">
  </div>

<!-- é é¦–å€å¡Š -->
<div class="top-bar">
  <div class="top-left">
    <h1 class="page-title">æ„›åƒç†Šç¾é£Ÿå åœ</h1>
    <p class="page-subtitle">ä¸æ˜¯æ­£åœ¨åƒç¾é£Ÿï¼Œå°±æ˜¯åœ¨åƒç¾é£Ÿçš„è·¯ä¸Š</p>
  </div>

  <div class="top-right">
    <div class="merit-pill">
      åŠŸå¾·å€¼ <span id="meritValue">0</span>
    </div>

    <!-- æ–°å¢ï¼šå‡ºéŠç†ŠæŒ‰éˆ• -->
    <a href="travel.html" class="travel-link-btn">
      å‡ºéŠç†Šå»æ—…è¡Œ ğŸŒ¤
    </a>
  </div>
</div>
    </header>

    <!-- ä¸»è¦–è¦ºï¼šå®Œæ•´ç†Šç†ŠåŸåœ–ï¼ˆä¸è£åˆ‡ï¼‰ -->
    <section class="temple-wrapper">
      <img src="images/bear-loading-couplet.png"
           alt="æ„›åƒç†Šèˆ‡ç¾é£Ÿ"
           class="temple-image" />
      <!-- ç†Šç†Šç¥ç¦å°è©±æ°£æ³¡ï¼ˆä¸Šä¾›å“ç”¨ï¼‰ -->
      <div id="bearBubble" class="bear-bubble"></div>
    </section>

    <!-- ç‹€æ…‹æç¤ºæ–‡å­— -->
    <p id="statusText" class="status-text">
      è«‹æŒ‰ã€ŒæŠ½è©©ç±¤ã€ï¼Œè®“æ„›åƒç†Šå¹«ä½ æ±ºå®šä»Šå¤©è¦åƒä»€éº¼ã€‚
    </p>

    <!-- æŠ½ç±¤å°æŒ‰éˆ•é€™ç‰ˆä¸ç”¨ï¼Œä¿ç•™çµæ§‹ -->
    <section class="draw-row hidden">
      <button id="drawBtn" class="pill-btn draw-btn">
        ğŸ§§ æŠ½ç±¤
      </button>
    </section>

    <!-- ä¸‹æ–¹å››é¡†å¥¶æ²¹è‰²åœ“å½¢å¤§æŒ‰éˆ• -->
    <section class="round-button-row">
      <button id="boBtn" class="round-btn">
        ğŸ§§<span>æŠ½è©©ç±¤</span>
      </button>

      <button id="offerBtn" class="round-btn">
        ğŸ±<span>ä¸Šä¾›å“</span>
      </button>

      <button id="historyBtn" class="round-btn">
        ğŸ“˜<span>æŠ½ç±¤ç´€éŒ„</span>
      </button>

      <button id="igBtn" class="round-btn">
        ğŸ“¸<span>æ„›åƒç†Š</span>
      </button>
    </section>

    <!-- ç›®å‰è©©ç±¤å¡ç‰‡ï¼ˆä¸­ç¹¼å®¹å™¨ï¼Œå¯¦éš›é¡¯ç¤ºæ”¹ç‚ºå½ˆçª—ï¼‰ -->
    <section id="currentLotCard" class="lot-card hidden"></section>
  </div>

  <!-- è©©ç±¤å½ˆçª—ï¼ˆå¤§ä¸€é»ï¼‹è©©ç±¤æ’ç‰ˆï¼‰ -->
  <div id="lotModal" class="modal hidden"
       onclick="if (event.target === this) window.closeAllModals();">
    <div class="modal-content">
      <div id="lotText"></div>
      <button id="closeLot" class="close-btn"
              onclick="window.closeAllModals();">
        é—œé–‰
      </button>
    </div>
  </div>

  <!-- æŠ½ç±¤ç´€éŒ„å½ˆçª— -->
  <div id="historyModal" class="modal hidden"
       onclick="if (event.target === this) window.closeAllModals();">
    <div class="modal-content history-modal-content">
      <div id="historyList"></div>
      <button id="closeHistory" class="close-btn"
              onclick="window.closeAllModals();">
        é—œé–‰
      </button>
    </div>
  </div>

  <!-- ====== å…¨éƒ¨é‚è¼¯éƒ½å¯«åœ¨é€™è£¡ï¼Œä¸å†éœ€è¦å¤–éƒ¨ script.js ====== -->
  <script>
    /* === å•Ÿå‹•ç•«é¢æ·¡å‡º === */
    function hideLoadingScreen() {
      const loading = document.getElementById('loading-screen');
      if (!loading) return;
      loading.classList.add('fade-out');
      setTimeout(() => loading.remove(), 700);
    }

    window.addEventListener('load', hideLoadingScreen);
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(hideLoadingScreen, 1800);
    });

    /* === åŠŸå¾·å€¼ +1 å‹•ç•« === */
    window.addMerit = function (delta) {
      if (!delta || delta <= 0) return;

      const badgeValue = document.getElementById('merit');
      if (!badgeValue) return;

      const current = parseInt(badgeValue.textContent || '0', 10);
      const next = current + delta;
      badgeValue.textContent = next;

      const badge = document.querySelector('.merit-badge');
      if (!badge) return;

      const plus = document.createElement('span');
      plus.className = 'merit-plus';
      plus.textContent = '+' + delta;
      badge.appendChild(plus);

      setTimeout(() => plus.remove(), 900);
    };

    /* === æ„›åƒç†Šç¥ç¦èªï¼ˆä¾›å“ç”¨ï¼‰ === */
    const BEAR_BLESSINGS = [
      "æ„›åƒç†Šé€ä½ ä¸€å£å¥½å¿ƒæƒ…ï¼Œè¨˜å¾—æ…¢æ…¢åƒã€å¥½å¥½åƒã€‚",
      "ä½ ä»Šå¤©è¾›è‹¦äº†ï¼Œçµ¦è‡ªå·±ä¸€ä»½å¥½åƒçš„ï¼Œå°±æœƒæ›´æœ‰åŠ›é‡å–”ï¼",
      "è‚šå­è¢«ç…§é¡§å¥½ï¼Œå¿ƒæƒ…ä¹Ÿæœƒè·Ÿè‘—è®Šç”œç”œçš„ã€‚",
      "é¡˜æ¯ä¸€é¤éƒ½èƒ½å®‰æ…°ä½ ï¼Œæ„›åƒç†Šé™ªä½ ä¸€èµ·åƒå¥½æ–™ã€‚",
      "å¥½å¥½åƒé£¯ä¸æ˜¯å¥¢ä¾ˆï¼Œæ˜¯ä¸€ç¨®å°è‡ªå·±çš„æº«æŸ”ã€‚",
      "åƒé£½çš„äººæœ€å¯æ„›ï¼Œé¡˜ä½ ä»Šå¤©ä¹Ÿæ˜¯å¯æ„›çš„ã€‚",
      "æ„›åƒç†Šç¥ç¦ä½ ï¼šæ¯ä¸€å£éƒ½å‰›å‰›å¥½ã€æ¯ä¸€æ­¥éƒ½é †é †çš„ã€‚",
      "ä¸ç”¨å‹‰å¼·å¾®ç¬‘ï¼Œå…ˆåƒå¥½åƒçš„ï¼Œç¬‘å®¹å°±æœƒè‡ªç„¶è·‘å‡ºä¾†ã€‚",
      "çµ¦è‡ªå·±ä¸€å£æº«æš–ï¼Œä¸–ç•Œå°±æœƒè®Šå¾—æ²’é‚£éº¼å¯æ€•ã€‚",
      "é¡˜ä½ çš„è‚šå­é£½é£½ã€å¿ƒä¹Ÿæš–æš–ï¼Œä»Šå¤©è¾›è‹¦çš„éƒ½å€¼å¾—ã€‚",
      "æ„›åƒç†Šæé†’ä½ ï¼šå¥½å¥½åƒé£¯ï¼Œæ˜¯æœ€ç°¡å–®çš„å¹¸ç¦é­”æ³•ã€‚",
      "é¡˜ä½ æ¯ä¸€é¤éƒ½èƒ½ç™‚ç™’è‡ªå·±ï¼Œè€Œä¸æ˜¯å‹‰å¼·è‡ªå·±ã€‚",
      "ä½ å€¼å¾—è¢«å¥½å¥½é¤µé£½ï¼Œä¹Ÿå€¼å¾—è¢«å¥½å¥½å°å¾…ã€‚",
      "åƒæ±è¥¿æ™‚è«‹æ”¾é¬†ï¼Œå‰©ä¸‹çš„äº‹äº¤çµ¦æ˜å¤©çš„ä½ å°±å¥½ã€‚",
      "é¡˜å¥½çš„å‘³é“é™ªè‘—ä½ ï¼ŒæŠŠå£å¿ƒæƒ…ä¸€é»ä¸€é»èåŒ–æ‰ã€‚",
      "æ„›åƒç†Šçµ¦ä½ ä¸€å€‹æŠ±æŠ±ï¼Œå†çµ¦ä½ ä¸€ä»½å¥½åƒçš„ã€‚",
      "é¡˜ä½ çš„ç¢—è£¡æ°¸é è£è‘—å®‰å¿ƒã€æœŸå¾…èˆ‡å°å°çš„å¿«æ¨‚ã€‚",
      "å¦‚æœè¦ºå¾—ç´¯ï¼Œé‚£å°±å…ˆåƒå¥½åƒçš„ï¼Œæ„›åƒç†Šæœƒé™ªè‘—ä½ ã€‚"
    ];

    /* === æ„›åƒç†Šå°æé†’ï¼ˆè©©ç±¤è¦–çª—ç”¨ï¼‰=== */
    const BEAR_ADVICE = [
      "ä»Šå¤©å…ˆç…§é¡§å¥½è‚šå­ï¼Œå†å»é¢å°é‚£äº›è®“ä½ ç·Šå¼µçš„äº‹æƒ…å°±å¥½ã€‚",
      "æ…¢æ…¢åƒã€æ…¢æ…¢æƒ³ï¼Œä¸ç”¨ä¸€æ¬¡æŠŠæ‰€æœ‰ç­”æ¡ˆéƒ½æ‰¾å‡ºä¾†ã€‚",
      "å¦‚æœè¦ºå¾—å¿ƒè£¡äº‚ï¼Œå°±å…ˆå¾ä¸€é “å¥½å¥½åƒçš„é¤é–‹å§‹æ•´ç†ç”Ÿæ´»ã€‚",
      "å…è¨±è‡ªå·±æŒ‘ä¸€å€‹çœŸçš„æƒ³åƒçš„ï¼Œè€Œä¸æ˜¯ã€Œæ‡‰è©²åƒã€çš„æ±è¥¿ã€‚",
      "åƒé£¯æ™‚å°ˆå¿ƒäº«å—å‘³é“ï¼Œå°±æ˜¯åœ¨å¥½å¥½é™ªä¼´è‡ªå·±ã€‚",
      "ä½ å·²ç¶“å¾ˆåŠªåŠ›äº†ï¼Œçµ¦è‡ªå·±ä¸€é»å–œæ­¡çš„é£Ÿç‰©ç•¶å°çå‹µå§ã€‚"
    ];

    function getRandomAdvice() {
      return BEAR_ADVICE[
        Math.floor(Math.random() * BEAR_ADVICE.length)
      ];
    }

    /* === è©©ç±¤è³‡æ–™ï¼ˆå¯ä»¥ä¹‹å¾Œè‡ªå·±å¢åŠ  / æ›¿æ›ï¼‰ === */
    const LOTS = [
      {
        no: "ç¬¬ä¸€ç±¤",
        title: "æš–æ¹¯æ•‘é¤“é¾",
        mood: "æš–æš–é£½",
        food: "å‘³å™Œæ¹¯éºµä¸€ç¢—",
        kcal: 480,
        minutes: 20
      },
      {
        no: "ç¬¬äºŒç±¤",
        title: "æš–æ¹¯å¥½äººç·£",
        mood: "æš–æš–é£½",
        food: "æš–å‘¼å‘¼æ¹¯éºµä¸€ç¢—",
        kcal: 560,
        minutes: 22
      },
      {
        no: "ç¬¬ä¸‰ç±¤",
        title: "ç”œç”œè£œå‹‡æ°£",
        mood: "ç”œç”œé£½",
        food: "é»‘ç³–çç å¥¶èŒ¶ï¼ˆåŠç³–å°‘å†°ï¼‰",
        kcal: 420,
        minutes: 25
      },
      {
        no: "ç¬¬å…«ç±¤",
        title: "å¥¶èŒ¶å°ç¢ºå¹¸",
        mood: "å¹¸ç¦é£½",
        food: "é®®å¥¶èŒ¶ä¸€æ¯ï¼‹å°é»å¿ƒ",
        kcal: 320,
        minutes: 20
      },
      {
        no: "ç¬¬ä¹ç±¤",
        title: "æ°´æœå°é»å¿ƒ",
        mood: "å¾®å¾®é£½",
        food: "ç¶œåˆæ°´æœç›¤ä¸€ä»½",
        kcal: 120,
        minutes: 10
      },
      {
        no: "ç¬¬åäºŒç±¤",
        title: "è½‰å½ç‰›è‚‰éºµ",
        mood: "æš–æš–é£½",
        food: "ç‰›è‚‰éºµä¸€ç¢—",
        kcal: 680,
        minutes: 27
      },
      {
        no: "ç¬¬åä¸‰ç±¤",
        title: "ä¾¿ç•¶æ…¢æ…¢åš",
        mood: "éœ€è¦ä¼‘æ¯",
        food: "å®¶å¸¸ä¾¿ç•¶ä¸€ä»½ï¼ˆå¤šèœå°‘ç‚¸ï¼‰",
        kcal: 720,
        minutes: 29
      },
      {
        no: "ç¬¬åäº”ç±¤",
        title: "å°è¾£é†’è…¦æ¹¯",
        mood: "å¾®è¾£é£½",
        food: "å°è¾£é…¸è¾£æ¹¯ä¸€ç¢—",
        kcal: 350,
        minutes: 19
      },
      {
        no: "ç¬¬åä¹ç±¤",
        title: "ç«é‹æš–å®¶äºº",
        mood: "åœ˜åœ“é£½",
        food: "è”¬èœå¤šå¤šç«é‹ä¸€é‹ï¼ˆå¤§å®¶ä¸€èµ·åˆ†ï¼‰",
        kcal: 750,
        minutes: 30
      },
      {
        no: "ç¬¬äºŒåäºŒç±¤",
        title: "æ°´æœä¼‘æ¯ç«™",
        mood: "è£œå……å…ƒæ°£",
        food: "ä¸€ç›¤åˆ‡å¥½çš„æ°´æœï¼‹ç†±èŒ¶",
        kcal: 110,
        minutes: 9
      }
    ];

    /* === localStorage æŠ½ç±¤ç´€éŒ„ === */
    const STORAGE_KEY = "eatBearLotsHistory";

    function loadHistory() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) return arr;
        return [];
      } catch (e) {
        return [];
      }
    }

    function saveHistory(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    /* === é¡¯ç¤ºç†Šç†Šç¥ç¦æ°£æ³¡ï¼ˆä¸Šä¾›å“æŒ‰éˆ•ï¼‰ === */
    function showBearBlessing() {
      const bubble = document.getElementById('bearBubble');
      if (!bubble) return;

      const msg =
        BEAR_BLESSINGS[Math.floor(Math.random() * BEAR_BLESSINGS.length)];
      bubble.textContent = msg;

      bubble.classList.remove('show');
      void bubble.offsetWidth; // å¼·åˆ¶é‡ç¹ª
      bubble.classList.add('show');
    }

    /* === é—œé–‰æ‰€æœ‰å½ˆçª— === */
    window.closeAllModals = function () {
      document.getElementById('lotModal')?.classList.add('hidden');
      document.getElementById('historyModal')?.classList.add('hidden');
    };

    /* === æŠ½ç±¤ï¼šå¾ LOTS ä¸­éš¨æ©Ÿé¸ä¸€å¼µ === */
    function drawLot(isFromHistory, historyRecord) {
      const lotCard = document.getElementById('currentLotCard');
      if (!lotCard) return;

      let lot, timeText;
      if (isFromHistory && historyRecord) {
        // å¾æ­·å²ç´€éŒ„é‡çœ‹
        lotCard.innerText = historyRecord.fullText;
        return;
      } else {
        lot =
          LOTS[Math.floor(Math.random() * LOTS.length)];
      }

      const now = new Date();
      const yyyy = now.getFullYear();
      const MM = String(now.getMonth() + 1).padStart(2, "0");
      const dd = String(now.getDate()).padStart(2, "0");
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");
      timeText = `${yyyy}/${MM}/${dd} ${hh}:${mm}`;

      const fullText =
        `${lot.no}ï¼${lot.title}ï½œ${lot.mood}\n` +
        `${lot.food}\n` +
        `ç´„ ${lot.kcal} kcalï½œå»ºè­°å°é‹å‹• ${lot.minutes} åˆ†é˜`;

      // å¯«å…¥ä¸­ç¹¼å€ï¼ˆé€™è¡Œæœƒè§¸ç™¼ MutationObserver â†’ æ‰“é–‹è©©ç±¤å½ˆçª—ï¼‰
      lotCard.innerText = fullText;

      // å­˜é€²æ­·å²
      const history = loadHistory();
      history.push({
        time: now.getTime(),
        timeText,
        fullText
      });
      saveHistory(history);
      renderHistory();
    }

    /* === æŠ½ç±¤ç´€éŒ„ç•«é¢ === */
    function renderHistory() {
      const historyListEl = document.getElementById('historyList');
      if (!historyListEl) return;

      const history = loadHistory().sort((a, b) => b.time - a.time);

      historyListEl.innerHTML = "";

      const title = document.createElement('div');
      title.className = 'history-title';
      title.textContent = "ğŸ“˜ æŠ½ç±¤ç´€éŒ„";
      historyListEl.appendChild(title);

      if (history.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'history-empty';
        empty.textContent = "ç›®å‰é‚„æ²’æœ‰æŠ½ç±¤ç´€éŒ„ã€‚";
        historyListEl.appendChild(empty);
        return;
      }

      history.forEach((record) => {
        const item = document.createElement('div');
        item.className = 'history-item';

        const time = document.createElement('div');
        time.className = 'history-time';
        time.textContent = record.timeText;

        const lines = record.fullText.split(/\n+/);
        const summaryLine = document.createElement('div');
        summaryLine.className = 'history-summary';
        summaryLine.textContent = lines[0] || "";

        const detailLine = document.createElement('div');
        detailLine.className = 'history-detail';
        detailLine.textContent = (lines[1] || "") + " ï½œ " + (lines[2] || "");

        item.appendChild(time);
        item.appendChild(summaryLine);
        item.appendChild(detailLine);

        item.addEventListener('click', () => {
          // é»æ­·å²ï¼šå…ˆé—œæ‰ç´€éŒ„å½ˆçª—ï¼Œå†é‡é¡¯è©©ç±¤
          const historyModal = document.getElementById('historyModal');
          if (historyModal) historyModal.classList.add('hidden');

          const lotCard = document.getElementById('currentLotCard');
          if (lotCard) lotCard.innerText = record.fullText; // äº¤çµ¦ observer é–‹çª—
        });

        historyListEl.appendChild(item);

        // åˆ†éš”ç·š
        const hr = document.createElement('div');
        hr.className = 'history-divider';
        historyListEl.appendChild(hr);
      });
    }

    /* === DOM æº–å‚™å¥½ä¹‹å¾Œï¼Œæ›ä¸Šäº‹ä»¶ === */
    document.addEventListener('DOMContentLoaded', () => {
      const boBtn = document.getElementById('boBtn');
      const offerBtn = document.getElementById('offerBtn');
      const historyBtn = document.getElementById('historyBtn');
      const igBtn = document.getElementById('igBtn');
      const statusText = document.getElementById('statusText');
      const lotCard = document.getElementById('currentLotCard');
      const lotModal = document.getElementById('lotModal');
      const lotText = document.getElementById('lotText');
      const historyModal = document.getElementById('historyModal');
      const temple = document.querySelector('.temple-wrapper');

      /* --- æŠ½è©©ç±¤ï¼šæ¯æ¬¡éƒ½ +1 åŠŸå¾·ï¼Œå…ˆæœ‰æŠ½ç±¤å‹•ç•«å†å‡ºç±¤ --- */
      if (boBtn) {
        boBtn.addEventListener('click', () => {
          window.addMerit(1); // æ¯æ¬¡æŠ½ç±¤éƒ½ +1 åŠŸå¾·

          if (statusText)
            statusText.textContent = "æ„›åƒç†Šæ­£åœ¨å¹«ä½ ç¿»ç±¤ç­’ï¼Œç¨ç­‰ä¸€ä¸‹ä¸‹ï½";

          if (temple) {
            temple.classList.remove('shake');
            void temple.offsetWidth; // å¼·åˆ¶é‡ç¹ª
            temple.classList.add('shake');
          }

          // ç­‰å‹•ç•«æ™ƒä¸€ä¸‹å†å‡ºç±¤
          setTimeout(() => {
            drawLot(false);
            if (temple) temple.classList.remove('shake');
          }, 900);
        });
      }

      /* --- ä¸Šä¾›å“ï¼š+1 åŠŸå¾· + ç†Šç†Šç¥ç¦ --- */
      if (offerBtn) {
        offerBtn.addEventListener('click', () => {
          window.addMerit(1);
          showBearBlessing();
        });
      }

      /* --- æŠ½ç±¤ç´€éŒ„æŒ‰éˆ• --- */
      if (historyBtn && historyModal) {
        historyBtn.addEventListener('click', () => {
          renderHistory();
          historyModal.classList.remove('hidden');
        });
      }

      /* --- æ„›åƒç†Š IGï¼šé–‹ IG ç¶²é  --- */
      if (igBtn) {
        igBtn.addEventListener('click', () => {
          window.open('https://instagram.com/luckygbear', '_blank');
        });
      }

      /* --- ç›£è½ lotCard è®ŠåŒ– â†’ é¡¯ç¤ºè©©ç±¤å½ˆçª—ï¼ˆä¸¦åˆªæ‰é‚£å¥ã€Œé»é€™è£¡å¯å†æ¬¡æŸ¥çœ‹å®Œæ•´è©©ç±¤ã€ï¼‰ --- */
      if (lotCard && lotModal && lotText) {
        const observer = new MutationObserver(() => {
          const rawText = lotCard.innerText.trim();
          if (!rawText) return;

          // æŠŠæŠ½ç±¤ç´€éŒ„é—œæ‰ï¼Œé¿å…æ“‹ä½
          if (historyModal) historyModal.classList.add('hidden');

          let lines = rawText.split(/\n+/).map(l => l.trim()).filter(Boolean);

          // æŠŠã€Œ(é»é€™è£¡å¯å†æ¬¡æŸ¥çœ‹å®Œæ•´è©©ç±¤)ã€é€™é¡æç¤ºæ–‡å­—ç§»é™¤
          lines = lines.filter(line => !line.includes("é»é€™è£¡å¯å†æ¬¡æŸ¥çœ‹å®Œæ•´è©©ç±¤"));

          const title = lines[0] || "ä»Šæ—¥ç¾é£Ÿç±¤";
          const detailLine1 = lines[1] || "";
          const detailLine2 = lines[2] || "";
          const detailHtml = [detailLine1, detailLine2]
            .filter(Boolean)
            .map(l => l.replace(/ /g, "&nbsp;"))
            .join("<br>");

          let dishShort = detailLine1 || "å¥½åƒçš„ä¸€é¤";
          const poemLines = [
            `${dishShort}é¦™æ°£æš–å¿ƒæˆ¿`,
            "æ…¢æ…¢å…¥å£ä¸æ…Œä¸å¿™",
            "ç…§é¡§è‚šå­ä¹Ÿæ˜¯åŠ›é‡",
            "å¥½å¥½åƒé£¯å‹‡æ°£æ»¿æ»¿"
          ];

          const advice = getRandomAdvice();

          lotText.innerHTML = `
            <div class="lot-modal-card">
              <div class="lot-modal-title">${title}</div>

              <div class="lot-modal-section lot-poem">
                ${poemLines
                  .map(l => `<div class="lot-poem-line">${l}</div>`)
                  .join("")}
              </div>

              <div class="lot-modal-section">
                <div class="lot-section-label">ä»Šæ—¥åƒè²¨æŒ‡å¼•</div>
                <div class="lot-section-body">${detailHtml}</div>
              </div>

              <div class="lot-modal-section">
                <div class="lot-section-label">æ„›åƒç†Šå°æé†’</div>
                <div class="lot-section-body">${advice}</div>
              </div>
            </div>
          `;

          lotModal.classList.remove('hidden');
          lotCard.classList.add('hidden');

          if (statusText) {
            statusText.textContent =
              "æ„›åƒç†Šé£Ÿç¥å·²çµ¦ä½ ä»Šæ—¥çš„åƒè²¨è©©ç±¤ï¼Œå¯ä»¥æ…¢æ…¢å“å‘³ï¼Œä¹Ÿå¯ä»¥å†æŠ½ä¸‹ä¸€é¤ã€‚";
          }
        });

        observer.observe(lotCard, { childList: true, subtree: true });
      }

      // ä¸€é–‹å§‹å°±æŠŠæ­·å²é å…ˆæ•´ç†å¥½
      renderHistory();
    });
  </script>
</body>
</html>