<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-512.png">

  <meta name="theme-color" content="#f4a63a">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>五臟廟-愛吃熊</title>

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- 啟動畫面 -->
  <div id="loading-screen">
    <img src="images/bear-loading-couplet.png" alt="愛吃熊啟動畫面">
  </div>

  <div class="app">

    <!-- 標題 -->
    <header class="header">
      <div class="title">愛吃熊美食占卜</div>
      <div class="subtitle">不是正在吃美食，就是在吃美食的路上</div>
    </header>

    <!-- 主視覺：背景即熊熊圖 -->
    <section class="temple-wrapper">
      <div class="temple-image-box">

        <!-- 功德值角標 -->
        <div class="merit-badge">
          功德值 <span id="merit">0</span>
        </div>

        <!-- 浮動按鈕組 -->
        <div class="floating-buttons">
          <button id="boBtn" class="circle-btn circle-main">
            🙏<span>擲筊</span>
          </button>

          <button id="drawBtn" class="circle-btn circle-main hidden">
            🧧<span>抽籤</span>
          </button>

          <button id="historyBtn" class="circle-btn">
            📘<span>紀錄</span>
          </button>

          <button id="offerBtn" class="circle-btn small disabled">
            🍱<span>供品</span>
          </button>

          <!-- 隱藏清空按鈕，但保留 ID 給 script.js 用 -->
          <button id="resetBtn" class="circle-btn danger hidden">
            ♻️<span>清空</span>
          </button>
        </div>
      </div>
    </section>

    <!-- 狀態提示 -->
    <p id="statusText" class="status-text">
      請先擲筊，一次聖筊就可以抽籤
    </p>

  </div>

  <!-- 詩籤彈窗 -->
  <div id="lotModal" class="modal hidden"
       onclick="if (event.target === this) window.closeAllModals();">
    <div class="modal-content">
      <div id="lotText"></div>
      <button id="closeLot" class="close-btn"
              onclick="window.closeAllModals();">
        關閉
      </button>
    </div>
  </div>

  <!-- 紀錄彈窗 -->
  <div id="historyModal" class="modal hidden"
       onclick="if (event.target === this) window.closeAllModals();">
    <div class="modal-content">
      <div id="historyList"></div>
      <button id="closeHistory" class="close-btn"
              onclick="window.closeAllModals();">
        關閉
      </button>
    </div>
  </div>

  <script src="script.js"></script>

  <!-- 啟動畫面淡出 + 功德值動畫 -->
  <script>
    function hideLoadingScreen() {
      const loading = document.getElementById('loading-screen');
      if (!loading) return;
      loading.classList.add('fade-out');
      setTimeout(() => loading.remove(), 700);
    }

    window.addEventListener('load', hideLoadingScreen);
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(hideLoadingScreen, 1800);
    });

// 功德值：只會增加、不會減少
window.addMerit = function (delta) {
  // 只允許正數，不接受減少
  if (!delta || delta <= 0) return;

  const badgeValue = document.getElementById('merit');
  if (!badgeValue) return;

  const current = parseInt(badgeValue.textContent || '0', 10);
  const next = current + delta;
  badgeValue.textContent = next;

  // +1 / +5 飄字動畫
  const badge = document.querySelector('.merit-badge');
  if (!badge) return;

  const plus = document.createElement('span');
  plus.className = 'merit-plus';
  plus.textContent = '+' + delta;
  badge.appendChild(plus);

  setTimeout(() => plus.remove(), 800);
};
// 18 句熊熊食神祝福
const BEAR_BLESSINGS = [
  "熊熊食神祝你三餐都有好東西吃～",
  "今天的胃口也要被好好照顧喔！",
  "吃飽飽，心情就會亮晶晶 ✨",
  "你願意照顧自己的肚子，好棒的功德～",
  "慢慢吃、好好吃，給自己一點溫柔。",
  "熊熊幫你加持：每一口都沒有罪惡感。",
  "把愛吃的東西放進心裡，也放進肚子裡。",
  "今天的你，值得被好好餵飽。",
  "感謝自己走到這裡，先吃一口再說。",
  "就算心情普通，食物也能偷偷加一點快樂進去。",
  "吃東西的時候，請暫時不用那麼勇敢，先好好享受。",
  "每一份你選擇的食物，都是在照顧自己的方式。",
  "給肚子一點時間，也給情緒一點空間。",
  "熊熊說：吃飯不是拖累，是補充魔法的儀式。",
  "願你今天吃到的每一口都剛剛好。",
  "願你不只吃飽，也吃到安心與被愛的感覺。",
  "好好吃飯，就是對自己最溫柔的修行。",
  "世界有點累沒關係，先讓晚餐抱抱你。"
];

// 在 temple-wrapper 上顯示 / 更新氣泡
function showBearBlessing() {
  const wrapper = document.querySelector('.temple-wrapper');
  if (!wrapper) return;

  let bubble = document.getElementById('bearBubble');
  if (!bubble) {
    bubble = document.createElement('div');
    bubble.id = 'bearBubble';
    bubble.className = 'bear-bubble';
    wrapper.appendChild(bubble);
  }

  const msg =
    BEAR_BLESSINGS[Math.floor(Math.random() * BEAR_BLESSINGS.length)];
  bubble.textContent = msg;

  // 重新觸發動畫
  bubble.classList.remove('show');
  // 強制重繪一次
  void bubble.offsetWidth;
  bubble.classList.add('show');
}
    /* 全域關閉彈窗 */
    window.closeAllModals = function () {
      document.getElementById('lotModal').classList.add('hidden');
      document.getElementById('historyModal').classList.add('hidden');
    };
  </script>
</body>
</html>