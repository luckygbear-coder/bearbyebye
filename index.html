<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>五臟廟-愛吃熊</title>

  <!-- PWA / Icon 設定 -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-512.png">
  <meta name="theme-color" content="#f4a63a">

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- 啟動畫面：進來時先看到熊熊整張圖 -->
  <div id="loading-screen">
    <img src="images/bear-loading-couplet.png" alt="愛吃熊啟動畫面">
  </div>

  <div class="app">
    <!-- 標題 -->
    <header class="header">
      <div class="title">愛吃熊美食占卜</div>
      <div class="subtitle">不是正在吃美食，就是在吃美食的路上</div>
    </header>

    <!-- 主視覺：熊熊圖當背景 + 浮動功能按鈕 + 功德值 -->
    <section class="temple-wrapper">
      <div class="temple-image-box">
        <!-- 功德值角標（右上角，不擋對聯） -->
        <div class="merit-badge">
          功德值 <span id="merit">0</span>
        </div>

        <!-- 浮動圓形按鈕：貼在右下 -->
        <div class="floating-buttons">
          <button id="boBtn" class="circle-btn circle-main">
            🙏<span>擲筊</span>
          </button>

          <button id="drawBtn" class="circle-btn circle-main hidden">
            🧧<span>抽籤</span>
          </button>

          <button id="historyBtn" class="circle-btn">
            📘<span>紀錄</span>
          </button>

          <button id="offerBtn" class="circle-btn small">
            🍱<span>供品</span>
          </button>

          <!-- 清空按鈕：給 script.js 用，但畫面隱藏 -->
          <button id="resetBtn" class="circle-btn danger hidden">
            ♻️<span>清空</span>
          </button>
        </div>
      </div>

      <!-- 熊熊祝福對話氣泡（用 JS 填文字） -->
      <div id="bearBubble" class="bear-bubble"></div>
    </section>

    <!-- 狀態提示文字 -->
    <p id="statusText" class="status-text">
      請先擲筊，一次聖筊就可以抽籤（聖筊機率 90%）
    </p>

    <!-- 如果 script.js 有用到目前詩籤卡片，就保留一個空容器 -->
    <section id="currentLotCard" class="lot-card hidden"></section>
  </div>

  <!-- 詩籤彈窗 -->
  <div id="lotModal" class="modal hidden"
       onclick="if (event.target === this) window.closeAllModals();">
    <div class="modal-content">
      <div id="lotText"></div>
      <button id="closeLot" class="close-btn"
              onclick="window.closeAllModals();">
        關閉
      </button>
    </div>
  </div>

  <!-- 抽籤 & 功德紀錄彈窗 -->
  <div id="historyModal" class="modal hidden"
       onclick="if (event.target === this) window.closeAllModals();">
    <div class="modal-content">
      <div id="historyList"></div>
      <button id="closeHistory" class="close-btn"
              onclick="window.closeAllModals();">
        關閉
      </button>
    </div>
  </div>

  <!-- 你的原本遊戲邏輯（擲筊 / 抽籤 / 寫紀錄） -->
  <script src="script.js"></script>

  <!-- 啟動畫面、功德動畫、愛吃熊祝福、供品邏輯 -->
  <script>
    /* --- 啟動畫面淡出 --- */
    function hideLoadingScreen() {
      const loading = document.getElementById('loading-screen');
      if (!loading) return;
      loading.classList.add('fade-out');
      setTimeout(() => loading.remove(), 700);
    }

    window.addEventListener('load', hideLoadingScreen);
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(hideLoadingScreen, 1800);
    });

    /* --- 愛吃熊祝福語（18句） --- */
    const BEAR_BLESSINGS = [
      "愛吃熊送你一口好心情，記得慢慢吃、好好吃。",
      "你今天辛苦了，給自己一份好吃的，就會更有力量喔！",
      "肚子被照顧好，心情也會跟著變甜甜的。",
      "願每一餐都能安慰你，愛吃熊陪你一起吃好料。",
      "好好吃飯不是奢侈，是一種對自己的溫柔。",
      "吃飽的人最可愛，願你今天也是可愛的。",
      "愛吃熊祝福你：每一口都剛剛好、每一步都順順的。",
      "不用勉強微笑，先吃好吃的，笑容就會自然跑出來。",
      "給自己一口溫暖，世界就會變得沒那麼可怕。",
      "願你的肚子飽飽、心也暖暖，今天辛苦的都值得。",
      "愛吃熊提醒你：好好吃飯，是最簡單的幸福魔法。",
      "願你每一餐都能療癒自己，而不是勉強自己。",
      "你值得被好好餵飽，也值得被好好對待。",
      "吃東西時請放鬆，剩下的事交給明天的你就好。",
      "願好的味道陪著你，把壞心情一點一點融化掉。",
      "愛吃熊給你一個抱抱，再給你一份好吃的。",
      "願你的碗裡永遠裝著安心、期待與小小的快樂。",
      "如果覺得累，那就先吃好吃的，愛吃熊會陪著你。"
    ];

    /* --- 功德值：只會增加，不會減少 --- */
    window.addMerit = function (delta) {
      if (!delta || delta <= 0) return; // 不接受扣分

      const badgeValue = document.getElementById('merit');
      if (!badgeValue) return;

      const current = parseInt(badgeValue.textContent || '0', 10);
      const next = current + delta;
      badgeValue.textContent = next;

      // 飄出的 +1 動畫
      const badge = document.querySelector('.merit-badge');
      if (!badge) return;

      const plus = document.createElement('span');
      plus.className = 'merit-plus';
      plus.textContent = '+' + delta;
      badge.appendChild(plus);

      setTimeout(() => plus.remove(), 900);
    };

    /* --- 熊熊祝福氣泡 --- */
    function showBearBlessing() {
      const bubble = document.getElementById('bearBubble');
      if (!bubble) return;

      const msg =
        BEAR_BLESSINGS[Math.floor(Math.random() * BEAR_BLESSINGS.length)];
      bubble.textContent = msg;

      bubble.classList.remove('show');
      void bubble.offsetWidth; // 強制重繪
      bubble.classList.add('show');
    }

    /* --- 關閉所有彈窗 --- */
    window.closeAllModals = function () {
      const lotModal = document.getElementById('lotModal');
      const historyModal = document.getElementById('historyModal');
      if (lotModal) lotModal.classList.add('hidden');
      if (historyModal) historyModal.classList.add('hidden');
    };

    /* --- 啟用上供品按鈕：不扣功德，按一下 +1 & 祝福 --- */
    document.addEventListener('DOMContentLoaded', () => {
      const offerBtn = document.getElementById('offerBtn');
      if (!offerBtn) return;

      // 確保不會被標記 disabled
      offerBtn.disabled = false;
      offerBtn.classList.remove('disabled');

      offerBtn.addEventListener('click', () => {
        window.addMerit(1);   // 上供品 +1 功德
        showBearBlessing();   // 顯示愛吃熊祝福
      });
    });
  </script>
</body>
</html>