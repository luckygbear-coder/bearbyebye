<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ„›åƒç†Šç¾é£Ÿå åœ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ======= å…¨åŸŸæ¨£å¼ ======= */
        body {
      margin: 0;
      padding: 0;
      background: #ffb54b; /* ä¸Šæ–¹æ©˜è‰²ç‹€æ…‹åˆ—ä¸‹é¢é‚£æ¢ */
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .app-wrap {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      background: #ffeec9;
      padding: 12px 16px 20px;
      box-sizing: border-box;
    }

    /* ======= Header å€ï¼šæ¨™é¡Œ + å‰¯æ¨™ + åŠŸå¾·å€¼ ======= */
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .title-block h1 {
      margin: 0;
      font-size: 22px;
      color: #7a4329;
      font-weight: 700;
    }

    .title-block p {
      margin: 4px 0 0 0;
      font-size: 13px;
      color: #9b5b36;
    }

    .merit-pill {
      font-size: 13px;
      color: #9b5b36;
      background: #fff7e0;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1.5px solid #f0c57a;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      white-space: nowrap;
    }

    /* ======= ç†Šç†Šå¤§åœ–å¡ç‰‡ ======= */
    .main-card {
      margin-top: 16px;
      background: #ffe3b1;
      border-radius: 26px;
      padding: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .main-illust {
      border-radius: 22px;
      overflow: hidden;
    }

    .main-illust img {
      width: 100%;
      display: block;
      height: auto;
    }

    /* ======= æç¤ºæ–‡å­— ======= */
    .hint-text {
      margin-top: 14px;
      font-size: 13px;
      color: #7a4329;
      text-align: center;
    }

    /* ======= ä¸‹æ–¹å››é¡†åœ“å½¢åŠŸèƒ½æŒ‰éˆ• ======= */
    .menu-row {
      margin-top: 14px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .menu-btn {
      flex: 1;
      max-width: 90px;
      text-decoration: none;
      color: #7a4329;
      text-align: center;
      font-size: 12px;
    }

    .menu-circle {
      width: 78px;
      height: 78px;
      margin: 0 auto 4px;
      border-radius: 50%;
      background: #fffaf2;
      border: 1.5px solid #f5d1a8;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    .menu-circle img {
      width: 30px;
      height: 30px;
      margin-bottom: 4px;
      display: block;
    }

    .menu-label {
      line-height: 1.2;
    }

    .menu-btn:active .menu-circle {
      transform: scale(0.95);
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
    }

    /* ======= æŠ½ç±¤çµæœå¡ ======= */
    .result-card {
      margin-top: 16px;
      background: #fff7ea;
      border-radius: 18px;
      border: 2px solid #f3c690;
      padding: 12px 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
      display: none;
    }

    .result-title {
      font-size: 15px;
      font-weight: 700;
      color: #7a4329;
      margin-bottom: 4px;
    }

    .result-main {
      font-size: 14px;
      color: #7a4329;
      margin-bottom: 6px;
    }

    .result-tag {
      font-size: 12px;
      color: #9b5b36;
      margin-bottom: 8px;
    }

    .result-bear {
      font-size: 13px;
      color: #6a3b3b;
      line-height: 1.6;
      white-space: pre-line;
    }

    /* ======= Loading ç­‰å¾…å‹•ç•« ======= */
    .loading {
      margin-top: 12px;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 12px;
      color: #9b5b36;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #ff9f6b;
      animation: bounce 0.8s infinite alternate;
    }

    .dot:nth-child(2) { animation-delay: 0.15s; }
    .dot:nth-child(3) { animation-delay: 0.3s; }

    @keyframes bounce {
      from { transform: translateY(0); opacity: 0.4; }
      to   { transform: translateY(-6px); opacity: 1; }
    }

    /* ======= +1 åŠŸå¾·å€¼å‹•ç•« ======= */
    .plus-one {
      position: fixed;
      top: 80px;
      right: 30px;
      font-size: 18px;
      color: #ff7b59;
      font-weight: 700;
      opacity: 0;
      pointer-events: none;
    }

    .plus-one.show {
      animation: riseFade 0.8s ease-out forwards;
    }

    @keyframes riseFade {
      0%   { opacity: 0; transform: translateY(8px); }
      20%  { opacity: 1; }
      100% { opacity: 0; transform: translateY(-20px); }
    }

    /* ======= æŠ½ç±¤ç´€éŒ„å€ ======= */
    .history-wrap {
      margin-top: 12px;
      background: #fffaf3;
      border-radius: 14px;
      border: 1.5px dashed #f1d4aa;
      padding: 8px 10px;
      display: none;
      max-height: 120px;
      overflow-y: auto;
      font-size: 12px;
      color: #7a4329;
    }

    .history-title {
      font-weight: 700;
      margin-bottom: 4px;
    }

    .history-item {
      padding: 4px 0;
      border-bottom: 1px dashed #f1d4aa;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-time {
      font-size: 11px;
      color: #b08a62;
    }

    @media (max-width: 380px) {
      .title-block h1 { font-size: 20px; }
      .menu-circle { width: 72px; height: 72px; }
      .menu-circle img { width: 26px; height: 26px; }
    }
  </style>
</head>
<!-- ç±¤è©©çµæœè¦–çª— -->
<div class="modal-backdrop" id="modalResult">
  <div class="modal-window">
    <button class="modal-close" onclick="closeResult()">âœ•</button>
    <h2 id="modalResultTitle"></h2>
    <p id="modalResultMain"></p>
    <p class="modal-tag" id="modalResultTag"></p>
    <p class="modal-bear" id="modalResultBear"></p>
  </div>
</div>
<!-- ç´€éŒ„è¦–çª— -->
<div class="modal-backdrop" id="modalHistory">
  <div class="modal-window">
    <button class="modal-close" onclick="closeHistory()">âœ•</button>
    <h2>è¿‘æœŸç±¤è©©ç´€éŒ„</h2>
    <div id="historyListModal"></div>
  </div>
</div>
<body>
  <div class="app-wrap">

    <!-- Headerï¼šæ¨™é¡Œ ï¼‹ å‰¯æ¨™ ï¼‹ åŠŸå¾·å€¼ -->
    <div class="header-row">
      <div class="title-block">
        <h1>æ„›åƒç†Šç¾é£Ÿå åœ</h1>
        <p>ä¸æ˜¯æ­£åœ¨åƒç¾é£Ÿï¼Œå°±æ˜¯åœ¨åƒç¾é£Ÿçš„è·¯ä¸Š</p>
      </div>
      <div class="merit-pill">
        åŠŸå¾·å€¼ <span id="meritValue">0</span>
      </div>
    </div>

    <!-- ç†Šç†Šç¾é£Ÿæ’ç•«å¡ç‰‡ -->
    <div class="main-card">
      <div class="main-illust">
        <!-- é€™è£¡æ”¹æˆä½ å¯¦éš›çš„ç†Šç†Šç¾é£Ÿåœ–ç‰‡è·¯å¾‘ -->
        <img src="images/bear.png" alt="æ„›åƒç†Šç¾é£Ÿå åœ">
      </div>
    </div>

    <!-- æç¤ºæ–‡å­— -->
    <p class="hint-text">
      è«‹æŒ‰ã€ŒæŠ½è©©ç±¤ã€ï¼Œè®“æ„›åƒç†Šå¹«ä½ æ±ºå®šä»Šå¤©è¦åƒä»€éº¼ã€‚
    </p>

    <!-- å››é¡†åœ“å½¢æŒ‰éˆ•ï¼šæœ€å¾Œä¸€é¡†æ”¹æˆã€Œå»å“ªç©ã€é€£åˆ° travel.html -->
    <div class="menu-row">
      <!-- æŠ½è©©ç±¤ -->
      <a href="javascript:void(0)" class="menu-btn" id="btnDraw">
        <div class="menu-circle">
          <img src="images/icon-draw.png" alt="æŠ½è©©ç±¤">
          <div class="menu-label">æŠ½è©©ç±¤</div>
        </div>
      </a>

      <!-- ä¸Šä¾›å“ -->
      <a href="javascript:void(0)" class="menu-btn" id="btnOffer">
        <div class="menu-circle">
          <img src="images/icon-offer.png" alt="ä¸Šä¾›å“">
          <div class="menu-label">ä¸Šä¾›å“</div>
        </div>
      </a>

      <!-- æŠ½ç±¤ç´€éŒ„ -->
      <a href="javascript:void(0)" class="menu-btn" id="btnHistory">
        <div class="menu-circle">
          <img src="images/icon-history.png" alt="æŠ½ç±¤ç´€éŒ„">
          <div class="menu-label">æŠ½ç±¤ç´€éŒ„</div>
        </div>
      </a>

      <!-- å»å“ªç©ï¼ˆåŸæœ¬çš„ IG æ”¹æˆé€™é¡†ï¼‰ -->
      <a href="travel.html" class="menu-btn" id="btnTravel">
        <div class="menu-circle">
          <!-- å»ºè­°æ›æˆä½ åšå¥½çš„å‡ºéŠç†Šå°åœ– -->
          <img src="images/travel.png" alt="å»å“ªç©">
          <div class="menu-label">å»å“ªç©</div>
        </div>
      </a>
    </div>

    <!-- Loading å‹•ç•« -->
    <div class="loading" id="loading">
      æ„›åƒç†Šæ­£åœ¨å¹«ä½ æŠ½ç±¤â€¦
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>

    <!-- æŠ½ç±¤çµæœå¡ -->
    <div class="result-card" id="resultCard">
      <div class="result-title" id="resultTitle"></div>
      <div class="result-main" id="resultMain"></div>
      <div class="result-tag" id="resultTag"></div>
      <div class="result-bear" id="resultBear"></div>
    </div>

    <!-- æŠ½ç±¤ç´€éŒ„ -->
    <div class="history-wrap" id="historyWrap">
      <div class="history-title">ğŸ“ æœ€è¿‘ 3 æ¬¡ç±¤è©©</div>
      <div id="historyList"></div>
    </div>

    <!-- +1 åŠŸå¾·å€¼å‹•ç•«å­—æ¨£ -->
    <div class="plus-one" id="plusOne">+1</div>

  </div>

  <script>
    // ====== æŠ½ç±¤å…§å®¹ï¼ˆä½ å¯ä»¥ä¹‹å¾Œè‡ªå·±æ”¹æˆå®Œæ•´ç‰ˆæœ¬ï¼‰ ======
    const lots = [
      {
        title: "çç å¥¶èŒ¶å¥½æœ‹å‹ç±¤",
        main: "ä»Šå¤©é©åˆä¾†ä¸€æ¯ä½ æœ€å–œæ­¡çš„é£²æ–™ï¼Œæ­é…ä¸€ä»½å°é»å¿ƒã€‚",
        tag: "é£²æ–™ãƒ»ç”œé£Ÿãƒ»å°ç¢ºå¹¸",
        bear: "ğŸ» ç†Šç†Šèªªï¼šæ…¢æ…¢å–æ²’é—œä¿‚ï¼ŒæŠŠä»Šå¤©çš„è¾›è‹¦ä¹Ÿä¸€èµ·åä¸‹å»ï¼Œç„¶å¾Œè¨˜å¾—å°è‡ªå·±èªªè²è¾›è‹¦äº†ã€‚"
      },
      {
        title: "å®¶å¸¸é£¯æš–æš–ç±¤",
        main: "é©åˆåƒä¸€é “å®¶å¸¸å‘³çš„æ–™ç†ï¼Œå¯ä»¥æ˜¯æ»·è‚‰é£¯ã€æ»·é›è…¿æˆ–æ˜¯å‘³å™Œæ¹¯ã€‚",
        tag: "å®¶å¸¸èœãƒ»æ»·è‚‰é£¯ãƒ»æš–èƒƒ",
        bear: "ğŸ» ç†Šç†Šèªªï¼šæœ‰æ™‚å€™æœ€ç™‚ç™’çš„ä¸æ˜¯å¤§é¤ï¼Œè€Œæ˜¯é‚£ç¢—è®“ä½ è¦ºå¾—å®‰å¿ƒçš„ç™½é£¯å’Œç†±æ¹¯ã€‚"
      },
      {
        title: "æªäººä¸€èµ·åƒç±¤",
        main: "ä»Šå¤©é©åˆæ‰¾ä¸€å€‹äººä¸€èµ·åƒé£¯ï¼Œä¸ä¸€å®šè¦å¤§é¤ï¼Œä½†è¦å¯ä»¥èŠå¤©ã€‚",
        tag: "ä¸€èµ·åƒé£¯ãƒ»èŠå¤©ãƒ»é™ªä¼´",
        bear: "ğŸ» ç†Šç†Šèªªï¼šè·Ÿåœ¨ä¹çš„äººä¸€èµ·åƒé£¯ï¼Œèƒƒæœƒé£½ï¼Œå¿ƒä¹Ÿæœƒè¢«è£æ»¿ä¸€é»é»ã€‚"
      },
      {
        title: "ä¾¿ç•¶å°ç¢ºå¹¸ç±¤",
        main: "ç°¡å–®çš„ä¾¿ç•¶ä¹Ÿå¾ˆå¥½ï¼Œåªè¦è£¡é¢æœ‰ä½ å–œæ­¡çš„ä¸€æ¨£å°èœå°±è¶³å¤ ã€‚",
        tag: "ä¾¿ç•¶ãƒ»ä¸Šç­æ—ãƒ»å¿«é€Ÿè£œå……",
        bear: "ğŸ» ç†Šç†Šèªªï¼šä¸ç”¨æ¯ä¸€é¤éƒ½å®Œç¾ï¼Œæœ‰æ™‚å€™åªæ˜¯å¥½å¥½åƒå®Œä¸€å€‹ä¾¿ç•¶ï¼Œå°±æ˜¯å°è‡ªå·±çš„ç…§é¡§ã€‚"
      }
    ];

    // ====== DOM å–å¾— ======
    const btnDraw = document.getElementById("btnDraw");
    const btnOffer = document.getElementById("btnOffer");
    const btnHistory = document.getElementById("btnHistory");

    const loading = document.getElementById("loading");
    const resultCard = document.getElementById("resultCard");
    const resultTitle = document.getElementById("resultTitle");
    const resultMain = document.getElementById("resultMain");
    const resultTag = document.getElementById("resultTag");
    const resultBear = document.getElementById("resultBear");

    const meritValueEl = document.getElementById("meritValue");
    const plusOne = document.getElementById("plusOne");

    const historyWrap = document.getElementById("historyWrap");
    const historyList = document.getElementById("historyList");

    // ====== ç‹€æ…‹ & localStorage ======
    const STORAGE_MERIT = "luckyg_merit";
    const STORAGE_HISTORY = "luckyg_food_history";

    let merit = 0;
    let history = [];

    function loadState() {
      try {
        const m = parseInt(localStorage.getItem(STORAGE_MERIT) || "0", 10);
        if (!isNaN(m)) merit = m;
        const h = JSON.parse(localStorage.getItem(STORAGE_HISTORY) || "[]");
        if (Array.isArray(h)) history = h;
      } catch(e) {
        merit = 0;
        history = [];
      }
      updateMerit();
      renderHistory();
    }

    function saveState() {
      localStorage.setItem(STORAGE_MERIT, String(merit));
      localStorage.setItem(STORAGE_HISTORY, JSON.stringify(history));
    }

    function updateMerit() {
      meritValueEl.textContent = merit;
    }

    // +1 å‹•ç•«
    function showPlusOne(text) {
      plusOne.textContent = text;
      plusOne.classList.remove("show");
      void plusOne.offsetWidth;
      plusOne.classList.add("show");
    }

    // ====== æŠ½ç±¤ ======
    btnDraw.addEventListener("click", () => {
      resultCard.style.display = "none";
      loading.style.display = "flex";

      setTimeout(() => {
        loading.style.display = "none";

        const picked = lots[Math.floor(Math.random() * lots.length)];
        const now = new Date();

        resultTitle.textContent = picked.title;
        resultMain.textContent  = picked.main;
        resultTag.textContent   = "é—œéµå­—ï¼š" + picked.tag;
        resultBear.textContent  = picked.bear;
        resultCard.style.display = "block";

        // åŠŸå¾·å€¼ +1
        merit += 1;
        updateMerit();
        showPlusOne("+1 åŠŸå¾·å€¼");
        // ç´€éŒ„
        history.unshift({
          time: now.toISOString(),
          title: picked.title,
          main: picked.main
        });
        if (history.length > 20) history.pop();
        saveState();
        renderHistory();
      }, 900);
    });

    // ====== ä¸Šä¾›å“ï¼šåŠŸå¾·å€¼ +3 ======
    btnOffer.addEventListener("click", () => {
      merit += 3;
      updateMerit();
      saveState();
      showPlusOne("+3 åŠŸå¾·å€¼");
    });

    // ====== æŠ½ç±¤ç´€éŒ„ é¡¯ç¤º/æ”¶åˆ ======
    btnHistory.addEventListener("click", () => {
      if (historyWrap.style.display === "block") {
        historyWrap.style.display = "none";
      } else {
        historyWrap.style.display = "block";
      }
    });

    function renderHistory() {
      if (!history.length) {
        historyList.innerHTML = '<div style="color:#b08a62;font-size:12px;">ç›®å‰é‚„æ²’æœ‰ç±¤è©©ç´€éŒ„ï¼Œå…ˆä¾†æŠ½ä¸€ç±¤å§ï½</div>';
        return;
      }
      // åªé¡¯ç¤ºæœ€æ–° 3 ç­†ï¼Œæ²å‹•å¯çœ‹æ›´å¤š
      const show = history.slice(0, 3);
      historyList.innerHTML = "";
      show.forEach(item => {
        const d = new Date(item.time);
        const div = document.createElement("div");
        div.className = "history-item";
        div.innerHTML = `
          <div>${item.title}</div>
          <div class="history-time">${d.toLocaleString("zh-TW",{hour12:false})}</div>
        `;
        historyList.appendChild(div);
      });
    }

    // åˆå§‹åŒ–
    loadState();
  </script>
</body>
</html>