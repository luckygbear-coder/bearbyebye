<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ä¾†ä¸€è¶Ÿèªªèµ°å°±èµ°çš„æ—…è¡Œï½œå‡ºéŠç†Šæ—…è¡Œç±¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    /* ======= åŸºæœ¬è¨­å®šï¼šä¸€é å¼ä¸æ²å‹• ======= */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      background: #ffb54b;
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
      overflow: hidden; /* æ•´é ä¸è¦æ»‘å‹• */
    }
    .app-wrap {
      max-width: 480px;
      height: 100vh;
      margin: 0 auto;
      background: #ffeec9;
      padding: 6px 12px 8px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }

    /* ======= Header ======= */
    .header {
      text-align: center;
      flex-shrink: 0;
    }
    .header h1 {
      margin: 2px 0 0 0;
      font-size: 20px;
      color: #7a4329;
    }
    .header p {
      margin: 2px 0 0 0;
      font-size: 12px;
      color: #9b5b36;
    }

    /* ======= ä¸Šæ–¹å¤§åœ–ï¼šå‡ºéŠç†Š + å°ç£åœ°åœ– ======= */
    .travel-hero-card {
      margin-top: 4px;
      background: #ffe3b1;
      border-radius: 20px;
      padding: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.16);
      flex-shrink: 0;
      position: relative; /* çµ¦ IG æŒ‰éˆ• & å°è©±æ¡†ç”¨ */
    }
    .travel-hero-img {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
    }
    .travel-hero-img img {
      width: 100%;
      display: block;
      height: auto;
      max-height: 230px; /* å£“ä¸€ä¸‹é«˜åº¦è®“ä¸‹é¢æ”¾å¾—ä¸‹ */
    }

    /* åœ°å€æŒ‰éˆ•ï¼šå¤§é¡†ï¼‹å¾®é€æ˜ */
    .region-chip {
      position: absolute;
      padding: 6px 16px;
      font-size: 14px;
      border-radius: 999px;
      border: 1.5px solid #f5d1a8;
      background: rgba(255, 250, 242, 0.9);
      color: #7a4329;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      cursor: pointer;
      white-space: nowrap;
      backdrop-filter: blur(2px);
    }
    .region-chip.active {
      background: rgba(255, 207, 152, 0.95);
      border-color: #f0a96b;
    }
    .region-chip:active {
      transform: scale(0.95);
      box-shadow: 0 1px 4px rgba(0,0,0,0.25);
    }

    /* ä½ç½®é‡æ–°æ‹‰é–‹ â€“ ä¸æ“‹é‡è¦å…ƒç´  */
    .chip-all     { top: 20%; left: 18%; }   /* ä¸æ“‹å¤ªé™½ */
    .chip-north   { top: 10%; right: 18%; }  /* ä¸é® 101 é ‚ç«¯ */
    .chip-central { top: 38%; right: 24%; }
    .chip-south   { top: 66%; right: 22%; }  /* ä¸æ“‹ç†Šç†Šèº«é«” */
    .chip-east    { top: 30%; right: 6%; }
    .chip-islands { top: 70%; left: 4%; }    /* ä¸è“‹è¡Œæç®± */

    /* ======= å‡ºéŠç†Šèªªè©±æ°£æ³¡ï¼ˆæŠ½ç±¤æ™‚å‡ºç¾ï¼‰ ======= */
    .bear-talk {
      position: absolute;
      right: 10px;
      top: 6px;
      max-width: 60%;
      background: #fffaf2;
      border-radius: 14px;
      padding: 6px 8px;
      border: 1.5px solid #f5d1a8;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      font-size: 12px;
      color: #7a4329;
      display: none;
    }

    /* ======= å‡ºéŠç†Š IG æŒ‰éˆ•ï¼ˆåœ¨åœ–ç‰‡å³ä¸Šè§’å¤–åœä¸€é»é»ï¼‰ ======= */
    .ig-btn {
      position: absolute;
      right: 8px;
      bottom: 6px;
      border-radius: 999px;
      padding: 4px 10px;
      background: #fff5de;
      border: 1.5px solid #f0c57a;
      font-size: 11px;
      color: #7a4329;
      text-decoration: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .ig-btn span {
      font-size: 13px;
    }

    /* ======= å°æ¨™é¡Œ ======= */
    .section-title {
      margin-top: 4px;
      text-align: center;
      flex-shrink: 0;
    }
    .section-title h2 {
      margin: 0;
      font-size: 18px;
      color: #7a4329;
    }
    .section-title p {
      margin: 2px 0 0 0;
      font-size: 12px;
      color: #9b5b36;
    }

    /* ======= åˆ†é åˆ‡æ›ï¼šå»å“ªç© / åƒä»€éº¼ ======= */
    .tab-row {
      margin-top: 4px;
      display: flex;
      background: #ffe3b1;
      border-radius: 999px;
      padding: 2px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      flex-shrink: 0;
    }
    .tab-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      background: transparent;
      font-size: 13px;
      color: #9b5b36;
      padding: 6px 0;
      cursor: pointer;
    }
    .tab-btn.active {
      background: #fffaf2;
      color: #7a4329;
      box-shadow: 0 2px 4px rgba(0,0,0,0.12);
    }

    /* ======= é¸é …å€ï¼šå‡ºéŠå°è±¡ + å¤©æ•¸ ======= */
    .options-row {
      margin-top: 4px;
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }
    .option-block {
      flex: 1;
      background: #fffaf2;
      border-radius: 14px;
      padding: 6px 8px;
      border: 1.5px solid #f5d1a8;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      font-size: 11px;
      color: #9b5b36;
    }
    .option-title {
      margin-bottom: 4px;
      font-weight: 600;
      color: #7a4329;
      font-size: 12px;
    }
    .target-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    .target-chip {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1.5px solid #f5d1a8;
      background: #fff;
      font-size: 11px;
      color: #7a4329;
      cursor: pointer;
    }
    .target-chip.active {
      background: #ffcf98;
      border-color: #f0a96b;
    }

    .day-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 0;
    }
    .day-btn {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1.5px solid #f5d1a8;
      background: #fff;
      font-size: 15px;
      color: #7a4329;
      cursor: pointer;
    }
    .day-value {
      min-width: 26px;
      text-align: center;
      font-size: 14px;
      color: #7a4329;
    }
    .day-note {
      margin-top: 2px;
      font-size: 10px;
      color: #b07a50;
    }

    /* ======= æŠ½ç±¤æŒ‰éˆ• + ä»Šæ—¥æ¬¡æ•¸ + ç´€éŒ„ ======= */
    .bottom-area {
      margin-top: 4px;
      flex-shrink: 0;
    }
    .btn-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .btn-draw {
      flex: 1.2;
      border-radius: 999px;
      border: none;
      padding: 8px 10px;
      font-size: 14px;
      font-weight: 600;
      color: #7a4329;
      background: linear-gradient(90deg, #ffb46f, #ff8f6b);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-draw:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }
    .btn-record {
      flex: 0.9;
      border-radius: 999px;
      border: 1.5px dashed #f0a96b;
      background: #fffaf2;
      padding: 7px 8px;
      font-size: 12px;
      color: #7a4329;
      cursor: pointer;
      white-space: nowrap;
    }

    .today-count {
      margin-top: 2px;
      font-size: 11px;
      color: #9b5b36;
      text-align: right;
    }

    .loading {
      margin-top: 3px;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 12px;
      color: #9b5b36;
    }
    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #ff9f6b;
      animation: bounce 0.8s infinite alternate;
    }
    .dot:nth-child(2) { animation-delay: 0.15s; }
    .dot:nth-child(3) { animation-delay: 0.3s; }
    @keyframes bounce {
      from { transform: translateY(0); opacity: 0.4; }
      to   { transform: translateY(-6px); opacity: 1; }
    }

    /* ======= Modal å…±ç”¨ ======= */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-backdrop.show { display: flex; }

    .modal-window {
      width: 88%;
      max-width: 420px;
      max-height: 80vh;
      overflow-y: auto;
      background: #fff7e6;
      border-radius: 18px;
      border: 2px solid #f3c690;
      padding: 12px 16px 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      position: relative;
    }
    .modal-close {
      position: absolute;
      right: 10px;
      top: 6px;
      font-size: 20px;
      background: none;
      border: none;
      color: #7a4329;
      cursor: pointer;
    }
    .modal-window h3 {
      margin: 4px 0 6px 0;
      font-size: 17px;
      color: #7a4329;
    }
    .modal-window p {
      font-size: 13px;
      color: #7a4329;
      line-height: 1.6;
      margin: 3px 0;
    }
    .modal-meta {
      font-size: 12px;
      color: #b07a50;
    }
    .modal-bear {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 12px;
      background: #fff1d6;
      border: 1px dashed #f0c57a;
      font-size: 12px;
      white-space: pre-line;
    }

    /* ç´€éŒ„åˆ—è¡¨ */
    #historyList {
      font-size: 13px;
      color: #7a4329;
    }
    .history-item {
      padding: 6px 0;
      border-bottom: 1px dashed #e8c08d;
      cursor: pointer;
    }
    .history-item:last-child { border-bottom: none; }
    .history-title { font-weight: 600; }
    .history-meta  { font-size: 11px; color: #b07a50; }

    .history-empty {
      font-size: 13px;
      color: #7a4329;
      margin-top: 6px;
    }

    @media (max-width: 380px) {
      .header h1 { font-size: 19px; }
      .region-chip { font-size: 13px; padding: 5px 12px; }
      .btn-draw { font-size: 13px; }
    }
  </style>
</head>
<body>
<div class="app-wrap">
  <header class="header">
    <h1>èªªèµ°å°±èµ°çš„æ—…è¡Œ</h1>
    <p>è®“å‡ºéŠç†Šé™ªä½ ä¸€èµ·åƒå–ç©æ¨‚â¤ï¸</p>
  </header>

  <!-- ä¸Šæ–¹å¤§åœ–ï¼šå‡ºéŠç†Š + å°ç£åœ°åœ–ï¼‹åœ°å€æŒ‰éˆ• -->
  <section class="travel-hero-card">
    <div class="travel-hero-img">
      <img src="images/travel.png" alt="å‡ºéŠç†Šå»å“ªç©">
      <button class="region-chip chip-all active"     id="btnAll">å…¨å°</button>
      <button class="region-chip chip-north"   id="btnNorth">åŒ—éƒ¨</button>
      <button class="region-chip chip-central" id="btnCentral">ä¸­éƒ¨</button>
      <button class="region-chip chip-south"   id="btnSouth">å—éƒ¨</button>
      <button class="region-chip chip-east"    id="btnEast">æ±éƒ¨</button>
      <button class="region-chip chip-islands" id="btnIslands">å¤–å³¶</button>
    </div>

    <!-- æŠ½ç±¤æ™‚å‡ºç¾çš„å‡ºéŠç†Šå°èª -->
    <div class="bear-talk" id="bearTalk"></div>

    <!-- å‡ºéŠç†Š IG æŒ‰éˆ• -->
    <a class="ig-btn" href="https://www.instagram.com/luckygbear" target="_blank" rel="noopener noreferrer">
      <span>ğŸ“·</span> å‡ºéŠç†Š IG @luckygbear
    </a>
  </section>

  <!-- æ¨™é¡Œ -->
  <section class="section-title">
    <h2>å»å“ªç©åƒä»€éº¼</h2>
    <p>é¸åœ°åœ–ä¸Šçš„åœ°é»ï¼Œå†æ­é…å‡ºéŠå°è±¡èˆ‡å¤©æ•¸ï¼Œè®“å‡ºéŠç†Šå¹«ä½ æŠ½ç±¤ï½</p>
  </section>

  <!-- åˆ†é åˆ‡æ› -->
  <div class="tab-row">
    <button class="tab-btn active" id="tabTravel">å»å“ªç©</button>
    <button class="tab-btn" id="tabFood">åƒä»€éº¼</button>
  </div>

  <!-- é¸é …å€ -->
  <div class="options-row">
    <div class="option-block">
      <div class="option-title">å‡ºéŠå°è±¡</div>
      <div class="target-chip-row">
        <button class="target-chip active" data-target="ä¸é™">ä¸é™</button>
        <button class="target-chip" data-target="è¦ªå­">è¦ªå­</button>
        <button class="target-chip" data-target="æƒ…ä¾¶">æƒ…ä¾¶</button>
        <button class="target-chip" data-target="å¤§äººæ”¾é¬†">å¤§äººæ”¾é¬†</button>
        <button class="target-chip" data-target="ä¸€å€‹äºº">ä¸€å€‹äºº</button>
      </div>
    </div>
    <div class="option-block">
      <div class="option-title">ç©å¹¾å¤©</div>
      <div class="day-row">
        <button class="day-btn" id="dayMinus">-</button>
        <div class="day-value" id="dayValue">2</div>
        <button class="day-btn" id="dayPlus">+</button>
      </div>
      <div class="day-note">(1â€“5 å¤©ï¼Œå°æ—…è¡Œæœ€å‰›å¥½)</div>
    </div>
  </div>

  <!-- ä¸‹æ–¹ï¼šæŠ½ç±¤ / ç´€éŒ„ / ä»Šæ—¥æ¬¡æ•¸ -->
  <div class="bottom-area">
    <div class="btn-row">
      <button class="btn-draw" id="btnDraw">æŠ½æ—…éŠç±¤ âœ¨</button>
      <button class="btn-record" id="btnHistory">æŸ¥çœ‹ç´€éŒ„ ğŸ“š</button>
    </div>

    <div class="loading" id="loading">
      å‡ºéŠç†Šå¹«ä½ æŠ½ç±¤ä¸­â€¦
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>

    <div class="today-count" id="todayCountText">
      ä»Šæ—¥æ—…éŠç±¤ï¼š0 æ¬¡ã€€ï½œã€€ä»Šæ—¥ç¾é£Ÿç±¤ï¼š0 æ¬¡
    </div>
  </div>
</div>

<!-- æŠ½ç±¤çµæœ Modal -->
<div class="modal-backdrop" id="modalResult">
  <div class="modal-window">
    <button class="modal-close" onclick="closeResult()">âœ•</button>
    <h3 id="modalResultTitle"></h3>
    <p class="modal-meta" id="modalResultMeta"></p>
    <p id="modalResultDesc"></p>
    <p class="modal-meta" id="modalResultExtra"></p>
    <p class="modal-bear" id="modalResultBear"></p>
  </div>
</div>

<!-- ç´€éŒ„ Modal -->
<div class="modal-backdrop" id="modalHistory">
  <div class="modal-window">
    <button class="modal-close" onclick="closeHistory()">âœ•</button>
    <h3>å‡ºéŠèˆ‡ç¾é£Ÿç´€éŒ„</h3>
    <p style="font-size:12px;color:#b07a50;margin:0 0 6px 0;">
      é»é¸ä¸€ç­†ç´€éŒ„ï¼Œå¯ä»¥é‡æ–°æŸ¥çœ‹ç•¶æ™‚çš„å‡ºéŠ / ç¾é£Ÿå»ºè­°ã€‚
    </p>
    <div id="historyList"></div>
  </div>
</div>

<script>
  // ======== å‡ºéŠç†Šå°èªï¼ˆæŠ½ç±¤æ™‚æœƒé¡¯ç¤ºåœ¨æ°£æ³¡è£¡ï¼‰ ========
  const bearTips = [
    "ä»Šå¤©æƒ³å»å“ªè£¡éƒ½å¯ä»¥ï¼Œæœ€é‡è¦çš„æ˜¯è·Ÿèª°ä¸€èµ·å»ï¼Œé‚„æœ‰è¦å°è‡ªå·±æº«æŸ”ä¸€é»ã€‚",
    "ä¸ä¸€å®šè¦æŠŠæ™¯é»æ’æ»¿ï¼Œåªè¦ç•™ä¸‹ä¸€å€‹ã€å¥½ç©ã€å¥½åƒã€å¥½ç¡ã€çš„æ—…è¡Œå°±å¾ˆå€¼å¾—ã€‚",
    "å¦‚æœç´¯äº†å°±æ…¢æ…¢èµ°ï¼Œæ—…è¡Œä¸æ˜¯æ¯”é€Ÿåº¦ï¼Œè€Œæ˜¯æ¯”èª°ç©å¾—æœ€èˆ’æœã€‚",
    "æ‹ç…§çš„åŒæ™‚ä¹Ÿè¨˜å¾—æŠ¬é ­çœ‹çœ‹é¢¨æ™¯ï¼Œè®“çœ¼ç›ä¹Ÿäº«å—ç¾åœ¨ã€‚",
    "æœ‰å°å­©åŒè¡Œæ²’é—œä¿‚ï¼Œå¤šä¸€é»ä¼‘æ¯ç«™ï¼Œå°±æœƒå¤šå¾ˆå¤šå¥½å¿ƒæƒ…ã€‚",
    "å³ä½¿åªæ˜¯åˆ°é™„è¿‘èµ°èµ°ï¼Œä¹Ÿæ˜¯ä¸€ç¨®æ—…è¡Œï¼Œå› ç‚ºä½ çš„å¿ƒé¡˜æ„å‡ºç™¼äº†ã€‚",
    "å¸¶ä¸€é»é›¶é£Ÿæˆ–æ°´æœåœ¨åŒ…åŒ…è£¡ï¼Œé¤“çš„æ™‚å€™å¿ƒæƒ…æ¯”è¼ƒä¸æœƒæš´èµ°ã€‚",
    "ä»Šå¤©å°±äº¤çµ¦å‡ºéŠç†Šå®‰æ’ï¼Œæ”¾å¿ƒç©ã€æ”¾å¿ƒåƒã€æ”¾å¿ƒç¬‘ã€‚"
  ];

  // ======== æ—…éŠæ™¯é»ï¼ˆç²¾ç°¡ç‰ˆï¼Œä¹‹å¾Œå¯å†åŠ ï¼‰ ========
  const travelSpots = [
    // åŒ—éƒ¨
    {
      region: "åŒ—éƒ¨", regionKey: "north",
      name: "é™½æ˜å±±å¤œæ™¯ & æº«æ³‰å°æ—…è¡Œ",
      daysMin: 1, daysMax: 2,
      targets: ["ä¸é™","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "ç™½å¤©ä¸Šå±±æ•£æ­¥çœ‹èŠ±ï¼Œæ™šä¸Šæ³¡æº«æ³‰ã€çœ‹å°åŒ—å¤œæ™¯ï¼Œå¾ˆé©åˆæƒ³æ”¾é¬†åˆä¸æƒ³è·‘å¤ªé çš„è¡Œç¨‹ã€‚",
      extra: "å¿…åƒï¼šå±±ä¸Šå°åº—çš„åœ°ç“œã€ç†±æ¹¯æˆ–å°ç«é‹ï¼Œåœ¨å†·å†·çš„ç©ºæ°£è£¡ç‰¹åˆ¥å¥½åƒã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šå±±ä¸Šæ—©æ™šæº«å·®å¤§ï¼Œè¨˜å¾—å¸¶å¤–å¥—ï¼›æƒ³æ‹ç…§çš„è©±ï¼Œè¡Œç¨‹åˆ¥æ’å¤ªæ»¿ï¼Œç•™çµ¦å¤•é™½ä¸€é»æ™‚é–“ã€‚"
    },
    {
      region: "åŒ—éƒ¨", regionKey: "north",
      name: "ä¹ä»½è€è¡— & é‡‘ç“œçŸ³å±±åŸæ•£æ­¥",
      daysMin: 1, daysMax: 2,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº"],
      desc: "èµ°é€²å±±åŸå°å··ï¼Œé€›è€è¡—ã€åƒèŠ‹åœ“ï¼Œçœ‹å±±æµ·äº¤ç•Œï¼Œå¤©æ°£å¥½æ™‚é æ–¹æµ·æ™¯è¶…ç™‚ç™’ã€‚",
      extra: "å¿…åƒï¼šèŠ‹åœ“ã€è‰ä»”ç²¿ã€é­šä¸¸æ¹¯ï¼›å¦‚æœä¸‹é›¨ï¼Œå±±åŸéœ§æ°£åè€Œå¤šäº†ä¸€ç¨®é­”æ³•æ„Ÿã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šå±±è·¯å¤šæ¨“æ¢¯ï¼Œé‹å­è¨˜å¾—ç©¿å¥½èµ°çš„ï¼Œè‚šå­é¤“æ™‚è€è¡—å°åƒéš¨ä¾¿ä¸€é–“éƒ½å¾ˆæš–å¿ƒã€‚"
    },
    {
      region: "åŒ—éƒ¨", regionKey: "north",
      name: "æ·¡æ°´æ²³ç•”å¤•é™½æ•£æ­¥",
      daysMin: 1, daysMax: 1,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº"],
      desc: "æ­æ·é‹å°±èƒ½åˆ°ï¼Œæ²³å²¸æ•£æ­¥ã€åƒå°åƒï¼Œå¤©æ°£å¥½æ™‚å¤•é™½ç‘åœ¨æ²³é¢ä¸Šè¶…ç¾ã€‚",
      extra: "å¿…åƒï¼šé˜¿çµ¦ã€é­šä¸¸æ¹¯ã€éµè›‹ï¼Œå†é…ä¸Šä¸€æ”¯å†°æ·‡æ·‹æ…¢æ…¢æ•£æ­¥å›å»ã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šå¤•é™½å¾Œé¢¨æœƒè®Šæ¶¼ï¼Œè¨˜å¾—å¸¶ä»¶è–„å¤–å¥—ï¼Œä¹Ÿå¯ä»¥å®‰æ’æ²³ç•”è…³è¸è»Šå°å°é‹å‹•ä¸€ä¸‹ã€‚"
    },

    // ä¸­éƒ¨
    {
      region: "ä¸­éƒ¨", regionKey: "central",
      name: "å°ä¸­å¯©è¨ˆæ–°æ‘ & è‰æ‚Ÿé“æ•£æ­¥",
      daysMin: 1, daysMax: 2,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº","å¤§äººæ”¾é¬†"],
      desc: "æ–‡å‰µå°åº—ã€ç¾é£Ÿèˆ‡ç¶ æ¨¹æ­¥é“ï¼Œä¸€æ•´å¤©æ…¢æ…¢é€›ã€ä¸è¶•æ™‚é–“ä¹Ÿä¸ç„¡èŠã€‚",
      extra: "å¿…åƒï¼šç‰¹è‰²å†°å“ã€å’–å•¡èˆ‡ç”œé»ï¼Œæ­é…è‰æ‚Ÿé“çš„ç¶ è”­ï¼Œå¾ˆæœ‰ç™‚ç™’æ„Ÿã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šå¯ä»¥å¸¶ä¸€æœ¬æ›¸æˆ–ç­†è¨˜æœ¬ï¼Œä¸€é‚Šå–å’–å•¡ä¸€é‚Šå¯«ä¸‹æ­¤åˆ»çš„å¿ƒæƒ…ã€‚"
    },
    {
      region: "ä¸­éƒ¨", regionKey: "central",
      name: "åˆæ­¡å±±çœ‹æ˜Ÿæ˜Ÿ & æ—¥å‡º",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "æ™šä¸Šçœ‹æ»¿å¤©æ˜Ÿæ˜Ÿï¼Œæ¸…æ™¨çœ‹æ—¥å‡ºå¾å±±é ­å†’å‡ºä¾†ï¼Œè¶…ç´šç™‚ç™’ï¼Œéœ€è¦ä¸€é»é«”åŠ›èˆ‡ä¿æš–è£å‚™ã€‚",
      extra: "è£œå……èƒ½é‡ï¼šå±±ä¸Šå¯ä»¥å¸¶ç†±å¯å¯ã€éºµåŒ…ã€å°é›¶é£Ÿï¼Œåœ¨çœ‹æ˜Ÿæ˜Ÿæ™‚æ…¢æ…¢äº«ç”¨ã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šå±±ä¸Šå†·åˆ°æœƒå‡ç†Šï¼Œè«‹å¸¶åšå¤–å¥—ã€å¸½å­ã€æ‰‹å¥—ï¼Œè¡Œç¨‹å‰ä¸€æ™šè¦ç¡é£½ä¸€é»ã€‚"
    },

    // å—éƒ¨
    {
      region: "å—éƒ¨", regionKey: "south",
      name: "å¢¾ä¸è—å¤©ç™½é›²æµ·é‚Šè¡Œç¨‹",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†"],
      desc: "ç™½å¤©æˆ²æ°´ã€æ•£æ­¥ï¼Œæ™šä¸Šé€›å¤§è¡—åƒæµ·ç”¢ï¼Œé©åˆæƒ³æ›¬å¤ªé™½ã€æ”¾ç©ºçš„å¤§äººå°å­©ã€‚",
      extra: "å¿…åƒï¼šæµ·é®®ã€ç¶¿ç¶¿å†°ã€å°é…’å§é£²å“ï¼Œé‚Šåƒé‚Šçœ‹æµ·é‚Šé¢¨æ™¯ã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šé˜²æ›¬ä¸€å®šè¦æ“¦ï¼Œå¸½å­å¢¨é¡ä¹Ÿå¸¶ä¸Šï¼Œç©æ°´å‰å¾Œå¤šè£œæ°´ï¼Œä¸è¦è®“è‡ªå·±è®Šæˆä¹¾ç†Šã€‚"
    },
    {
      region: "å—éƒ¨", regionKey: "south",
      name: "å°å—è€è¡—å··å¼„ç¾é£Ÿå°æ—…è¡Œ",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº"],
      desc: "ç™½å¤©é€›å¤è¹Ÿã€å–å’–å•¡ï¼Œæ™šä¸Šå·¡è¿´å„ç¨®å°åƒï¼Œé©åˆæ…¢æ…¢èµ°æ…¢æ…¢åƒçš„æ—…è¡Œã€‚",
      extra: "å¿…åƒï¼šç‰›è‚‰æ¹¯ã€é‹ç‡’æ„éºµã€ç¢—ç²¿ã€å¸ƒä¸ã€å†°å“ï¼Œä¸€å¤©çµ•å°åƒä¸å®Œã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šä¸è¦ä¸€æ¬¡æ’å¤ªå¤šåº—ï¼Œåƒåˆ°ä¸ƒåˆ†é£½å°±ä¼‘æ¯ï¼Œç•™ç©ºé–“çµ¦ä¸‹ä¸€å®¶é©šå–œã€‚"
    },

    // æ±éƒ¨
    {
      region: "æ±éƒ¨", regionKey: "east",
      name: "èŠ±è“®æµ·å²¸ç·šè‡ªé§•æ•£å¿ƒ",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "ä¸€è·¯çœ‹æµ·ã€åœé å°å’–å•¡é¤¨èˆ‡è§€æ™¯å°ï¼Œé©åˆæƒ³å¤§å£å‘¼å¸æµ·é¢¨çš„äººã€‚",
      extra: "å¿…åƒï¼šç‚¸å½ˆè”¥æ²¹é¤…ã€éº»ç³¬ã€æ‰é£Ÿæ¹¯ï¼Œå†é…ä¸Šæµ·é‚Šçš„é¢¨æ™¯ã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šé–‹è»Šæˆ–é¨è»Šæ™‚ä¸è¦å¤ªè¶•æ™‚é–“ï¼Œæœ‰æ¼‚äº®çš„é¢¨æ™¯å°±æ‰¾å®‰å…¨çš„åœ°æ–¹åœä¸‹ä¾†å¥½å¥½çœ‹ã€‚"
    },

    // å¤–å³¶
    {
      region: "å¤–å³¶", regionKey: "islands",
      name: "æ¾æ¹–è·³å³¶çœ‹è—æµ·",
      daysMin: 3, daysMax: 4,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†"],
      desc: "åƒåŠ è·³å³¶è¡Œç¨‹ã€æµ®æ½›ã€çœ‹ç„æ­¦å²©èˆ‡å¤•é™½ï¼Œæ˜¯å¾ˆæœ‰åº¦å‡æ„Ÿçš„æµ·å³¶æ—…ç¨‹ã€‚",
      extra: "å¿…åƒï¼šä»™äººæŒå†°ã€èŠ±æä¸¸ã€æµ·é®®ç‡’çƒ¤ï¼Œæ˜¯æ¾æ¹–å¿…åšçµ„åˆã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šæµ·å³¶ç´«å¤–ç·šè¶…å¼·ï¼Œé˜²æ›¬èˆ‡è£œæ°´è¦æ¯”å¹³å¸¸å†èªçœŸä¸€é»ï¼›æƒ³ç©æ°´å‹™å¿…æ³¨æ„å®‰å…¨ã€‚"
    },

    // å…¨å°
    {
      region: "å…¨å°", regionKey: "all",
      name: "ä»»é¸åŸå¸‚æ…¢éŠ 2 æ—¥å°æ—…è¡Œ",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "é¸ä¸€å€‹ä½ å¾ˆä¹…æ²’å»æˆ–é‚„æ²’å»éçš„åŸå¸‚ï¼Œä¸æ’å¤ªå¤šè¡Œç¨‹ï¼Œç”¨æ•£æ­¥çš„é€Ÿåº¦é‡æ–°èªè­˜å°ç£ã€‚",
      extra: "å¿…åƒï¼šç•¶åœ°äººæ¨è–¦çš„å¸‚å ´æ—©é¤ã€åœ¨åœ°é£²æ–™åº—ã€éš¨æ©Ÿè·¯é‚Šå°åƒã€‚",
      bear: "ğŸ» å‡ºéŠç†Šæé†’ï¼šé€™æ¬¡æ—…è¡Œçš„ä¸»é¡Œå«åšã€æ…¢ã€ï¼Œä¸ç”¨æŠŠæ‰€æœ‰æ™¯é»æ”¶é›†å®Œï¼Œåªè¦æŠŠå¿ƒå®‰é “å¥½å°±å¤ äº†ã€‚"
    }
  ];

  // ======== ç¾é£Ÿç±¤ ========
  const foodSpots = [
    { region:"åŒ—éƒ¨", regionKey:"north",
      name:"å°åŒ—å··å£ç‰›è‚‰éºµ",
      desc:"æ‰¾ä¸€é–“åœ¨åœ°äººæ„›çš„è€åº—ï¼Œä¾†ä¸€ç¢—ç´…ç‡’æˆ–æ¸…ç‡‰ç‰›è‚‰éºµï¼Œé…ä¸Šä¸€é»é…¸èœï¼Œæš–èƒƒä¹Ÿæš–å¿ƒã€‚",
      extra:"å°ç§˜è¨£ï¼šé»åŠç­‹åŠè‚‰æœ€éç™®ï¼Œåƒå®Œå¯ä»¥é™„è¿‘æ•£æ•£æ­¥å¹«åŠ©æ¶ˆåŒ–ã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šä»Šå¤©å¯ä»¥æŠŠé€™ç¢—éºµç•¶æˆçµ¦è‡ªå·±çš„ã€è¾›è‹¦çå‹µç¢—ã€ï¼Œæ…¢æ…¢åƒï¼Œä¸æ»‘æ‰‹æ©Ÿæ›´äº«å—ã€‚"
    },
    { region:"åŒ—éƒ¨", regionKey:"north",
      name:"åŸºéš†å»Ÿå£å¤œå¸‚å°åƒå·¡ç¦®",
      desc:"å¾å¤©å©¦ç¾…ã€ç‡Ÿé¤Šä¸‰æ˜æ²»ä¸€è·¯åƒåˆ°ç”œæ¹¯ï¼Œé©åˆå˜´å·´æƒ³ä¸€ç›´å¿™ç¢Œçš„æ—¥å­ã€‚",
      extra:"å°å»ºè­°ï¼šæ¯æ¨£éƒ½é»å°ä»½ä¸€èµ·åˆ†äº«ï¼Œè‚šå­è·Ÿè·åŒ…éƒ½æ¯”è¼ƒé–‹å¿ƒã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šå¤œå¸‚ç¾é£Ÿå¾ˆå¤šï¼Œé¸ä¸‰æ¨£æœ€æƒ³åƒçš„ç•¶ä¸»è§’ï¼Œå…¶å®ƒç•¶é©šå–œé…è§’å°±å¥½ã€‚"
    },

    { region:"ä¸­éƒ¨", regionKey:"central",
      name:"å°ä¸­å•†åœˆåœ°ç“œçƒ & é›æ’å·¡ç¦®",
      desc:"æ•£æ­¥é€›è¡—çš„åŒæ™‚ï¼Œä¸€é‚Šåƒåœ°ç“œçƒã€ç‚¸é›æ’ï¼Œè¶…æœ‰æ”¾å‡æ„Ÿã€‚",
      extra:"å»ºè­°ï¼šå¯ä»¥å…©ä¸‰å€‹äººåˆ†é£Ÿä¸€ä»½ï¼Œæ—¢æ»¿è¶³å£è…¹ä¹‹æ¬²åˆä¸æœƒå¤ªè² æ“”ã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šæƒ³åƒå°±åƒï¼Œä½†å¯ä»¥ç´„å®šä»Šå¤©å¤šèµ°å¹¾åƒæ­¥ï¼Œè®“èº«é«”ä¸€èµ·åƒèˆ‡é€™å ´ç¾é£Ÿæ´¾å°ã€‚"
    },
    { region:"ä¸­éƒ¨", regionKey:"central",
      name:"å½°åŒ–è‚‰åœ“ & éŠ…æ¿å°åƒ",
      desc:"è»ŸQå¤–çš®é…ä¸Šæ‰å¯¦è‚‰é¤¡ï¼Œå†æ­ä¸€ç¢—æ¹¯æˆ–ç±³ç³•ï¼Œæ˜¯åœ¨åœ°äººçš„æ—¥å¸¸å‘³ã€‚",
      extra:"ç§˜å¢ƒé«”é©—ï¼šè€è¡—é™„è¿‘å¸¸æœ‰æ²’æœ‰è£æ½¢çš„å°åº—ï¼Œå‘³é“å»å¾ˆé©šè‰·ã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šåƒå°åƒçš„æ™‚å€™ï¼Œä¸å¦¨è§€å¯Ÿä¸€ä¸‹åº—è£¡çš„é˜¿å…¬é˜¿å¬¤ï¼Œé€™å°±æ˜¯æœ€çœŸçš„ç”Ÿæ´»é¢¨æ™¯ã€‚"
    },

    { region:"å—éƒ¨", regionKey:"south",
      name:"å°å—ç‰›è‚‰æ¹¯ + é‹ç‡’æ„éºµæ—©é¤çµ„åˆ",
      desc:"ä¸€æ—©å–ç†±ç‰›è‚‰æ¹¯ï¼Œå†ä¾†ä¸€ç¢—é‹ç‡’æ„éºµï¼Œå—éƒ¨äººçš„å¹¸ç¦å„€å¼ä¸€æ¬¡é«”é©—ã€‚",
      extra:"åƒå®Œå¯ä»¥åœ¨å··å¼„è£¡æ•£æ­¥ï¼Œé †ä¾¿æ‰¾å’–å•¡åº—æˆ–è±†èŠ±ä¼‘æ¯ã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šæ—©èµ·åƒä¸€é “å¥½æ—©é¤ï¼Œæ˜¯å°ä»Šå¤©çš„è‡ªå·±èªªã€ä½ å€¼å¾—è¢«å¥½å¥½ç…§é¡§ã€ã€‚"
    },
    { region:"å—éƒ¨", regionKey:"south",
      name:"é«˜é›„é¹½åŸ•è€å­—è™Ÿå†°å“ & é¤…ä¹¾",
      desc:"åœ¨è€ç¤¾å€è£¡æ‰¾ä¸€é–“å†°åº—ï¼Œé»ä¸€ç¢—å¤æ—©å‘³å†°æˆ–é›ªèŠ±å†°ï¼Œæ…¢æ…¢åƒæ‰é‚£ä¸€é»é»æš‘æ°£ã€‚",
      extra:"å¯ä»¥æ­é…é™„è¿‘çš„å‚³çµ±é¤…èˆ–ï¼Œè²·å¹¾å¡Šé¤…ç•¶ä¸‹åˆèŒ¶ã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šåƒå†°æ™‚è¨˜å¾—å°å£æ…¢æ…¢åƒï¼Œè®“æ¶¼æ¶¼çš„å¿ƒæƒ…æ…¢æ…¢åœåœ¨å¿ƒè£¡ã€‚"
    },

    { region:"æ±éƒ¨", regionKey:"east",
      name:"èŠ±è“®ç‚¸å½ˆè”¥æ²¹é¤… & éº»ç³¬",
      desc:"ç«™åœ¨è·¯é‚Šæ’éšŠåƒè”¥æ²¹é¤…ï¼Œå†å¸¶å¹¾é¡†éº»ç³¬å›æ°‘å®¿ï¼Œæ˜¯å¾ˆå¤šäººåˆ°èŠ±è“®çš„å›ºå®šå„€å¼ã€‚",
      extra:"å¦‚æœå¤©æ°£è¨±å¯ï¼Œå¯ä»¥å¸¶è‘—é»å¿ƒåˆ°æµ·é‚Šï¼Œä¸€é‚Šçœ‹æµ·ä¸€é‚Šåƒã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šå˜´å·´å¿™çš„æ™‚å€™ï¼Œå¿ƒä¹Ÿè¨˜å¾—æ”¾é¬†ä¸€ä¸‹ï¼Œè®“æµ·é¢¨å¹«ä½ æŠŠç…©æƒ±å¹èµ°ã€‚"
    },

    { region:"å¤–å³¶", regionKey:"islands",
      name:"æ¾æ¹–æµ·é®®å¤§é¤ + ä»™äººæŒå†°",
      desc:"ç™½å¤©ç©æµ·ï¼Œæ™šä¸Šåƒæµ·é®®å¤§é¤ï¼Œæœ€å¾Œä¾†ä¸€æ”¯ä»™äººæŒå†°ä½œçµã€‚",
      extra:"å¯ä»¥é¸æ“‡å¹¾æ¨£çœŸçš„å¾ˆæƒ³åƒçš„æµ·é®®ï¼Œä¸ä¸€å®šè¦é»æ»¿æ•´æ¡Œã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šåƒæµ·é®®çš„åŒæ™‚ä¹Ÿè¦è¨˜å¾—è£œæ°´ï¼Œè®“èº«é«”ç¶­æŒåœ¨èˆ’æœçš„ç‹€æ…‹ã€‚"
    },

    { region:"å…¨å°", regionKey:"all",
      name:"çç å¥¶èŒ¶ & æ‰‹æ–é£²å°ç¢ºå¹¸",
      desc:"æŒ‘ä¸€æ¯ä½ å–œæ­¡çš„é£²æ–™ï¼Œä»Šå¤©å¯ä»¥é¸åŠç³–æˆ–å°‘å†°ï¼Œçµ¦èº«é«”ä¸€é»æº«æŸ”ã€‚",
      extra:"å–é£²æ–™æ™‚åˆ»æ„æ”¾æ…¢é€Ÿåº¦ï¼Œé‚Šå–é‚Šæ„Ÿè¬ä»Šå¤©é‚„åœ¨åŠªåŠ›çš„è‡ªå·±ã€‚",
      bear:"ğŸ» å‡ºéŠç†Šèªªï¼šç”œåº¦å°‘ä¸€é»ï¼Œç½ªæƒ¡æ„Ÿä¹Ÿæœƒå°‘ä¸€é»ï¼Œä½†å¹¸ç¦æ„Ÿé‚„æ˜¯å¾ˆå¤šã€‚"
    }
  ];

  // ======== ç‹€æ…‹ & localStorage ========
  let currentTab = "travel"; // travel | food
  let currentRegion = "all";
  let currentTarget = "ä¸é™";
  let currentDays = 2;

  const STORAGE_COUNTS = "travel_today_counts_v2";
  const STORAGE_HISTORY = "travel_history_v2";

  let todayCounts = { date: "", travel: 0, food: 0 };
  let history = []; // {time, type, data}

  // ======== DOM å–å¾— ========
  const tabTravel = document.getElementById("tabTravel");
  const tabFood   = document.getElementById("tabFood");
  const btnDraw   = document.getElementById("btnDraw");
  const loadingEl = document.getElementById("loading");
  const todayCountText = document.getElementById("todayCountText");
  const bearTalkEl = document.getElementById("bearTalk");

  const regionButtons = {
    all: document.getElementById("btnAll"),
    north: document.getElementById("btnNorth"),
    central: document.getElementById("btnCentral"),
    south: document.getElementById("btnSouth"),
    east: document.getElementById("btnEast"),
    islands: document.getElementById("btnIslands")
  };

  const targetChips = document.querySelectorAll(".target-chip");
  const dayMinus = document.getElementById("dayMinus");
  const dayPlus  = document.getElementById("dayPlus");
  const dayValue = document.getElementById("dayValue");

  const btnHistory   = document.getElementById("btnHistory");
  const modalHistory = document.getElementById("modalHistory");
  const historyList  = document.getElementById("historyList");

  const modalResult      = document.getElementById("modalResult");
  const modalResultTitle = document.getElementById("modalResultTitle");
  const modalResultMeta  = document.getElementById("modalResultMeta");
  const modalResultDesc  = document.getElementById("modalResultDesc");
  const modalResultExtra = document.getElementById("modalResultExtra");
  const modalResultBear  = document.getElementById("modalResultBear");

  // ======== æ—¥æœŸ ========
  function getTodayStr() {
    const d = new Date();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${d.getFullYear()}-${m}-${day}`;
  }

  // ======== localStorageï¼šè¨ˆæ•¸ ========
  function loadCounts() {
    try {
      const raw = localStorage.getItem(STORAGE_COUNTS);
      if (raw) {
        const obj = JSON.parse(raw);
        if (obj.date === getTodayStr()) {
          todayCounts = obj;
        }
      }
    } catch(e) {}
    updateCountsText();
  }
  function saveCounts() {
    todayCounts.date = getTodayStr();
    localStorage.setItem(STORAGE_COUNTS, JSON.stringify(todayCounts));
  }
  function updateCountsText() {
    todayCountText.textContent =
      `ä»Šæ—¥æ—…éŠç±¤ï¼š${todayCounts.travel} æ¬¡ã€€ï½œã€€ä»Šæ—¥ç¾é£Ÿç±¤ï¼š${todayCounts.food} æ¬¡`;
  }

  // ======== localStorageï¼šç´€éŒ„ ========
  function loadHistory() {
    try {
      const raw = localStorage.getItem(STORAGE_HISTORY);
      if (raw) history = JSON.parse(raw);
    } catch(e) {
      history = [];
    }
  }
  function saveHistory() {
    localStorage.setItem(STORAGE_HISTORY, JSON.stringify(history));
  }

  // ======== åˆ†é åˆ‡æ› ========
  function setTab(tab) {
    currentTab = tab;
    if (tab === "travel") {
      tabTravel.classList.add("active");
      tabFood.classList.remove("active");
      btnDraw.textContent = "æŠ½æ—…éŠç±¤ âœ¨";
    } else {
      tabFood.classList.add("active");
      tabTravel.classList.remove("active");
      btnDraw.textContent = "æŠ½ç¾é£Ÿç±¤ ğŸ´";
    }
  }
  tabTravel.addEventListener("click", () => setTab("travel"));
  tabFood.addEventListener("click", () => setTab("food"));

  // ======== åœ°å€åˆ‡æ› ========
  function setRegion(key) {
    currentRegion = key;
    Object.entries(regionButtons).forEach(([k, btn]) => {
      if (!btn) return;
      if (k === key) btn.classList.add("active");
      else btn.classList.remove("active");
    });
  }
  Object.entries(regionButtons).forEach(([key, btn]) => {
    if (!btn) return;
    btn.addEventListener("click", () => setRegion(key));
  });

  // ======== å‡ºéŠå°è±¡ ========
  targetChips.forEach(chip => {
    chip.addEventListener("click", () => {
      targetChips.forEach(c => c.classList.remove("active"));
      chip.classList.add("active");
      currentTarget = chip.dataset.target;
    });
  });

  // ======== å¤©æ•¸ +/- ========
  function updateDayDisplay() {
    dayValue.textContent = currentDays;
  }
  dayMinus.addEventListener("click", () => {
    if (currentDays > 1) {
      currentDays--;
      updateDayDisplay();
    }
  });
  dayPlus.addEventListener("click", () => {
    if (currentDays < 5) {
      currentDays++;
      updateDayDisplay();
    }
  });

  // ======== å‡ºéŠç†Šèªªè©±æ°£æ³¡ ========
  function showBearTalk() {
    const msg = bearTips[Math.floor(Math.random() * bearTips.length)];
    bearTalkEl.textContent = msg;
    bearTalkEl.style.display = "block";
    bearTalkEl.style.opacity = "1";
    setTimeout(() => {
      bearTalkEl.style.opacity = "0";
      setTimeout(() => {
        bearTalkEl.style.display = "none";
      }, 400);
    }, 2200);
  }

  // ======== æŠ½ç±¤çµæœ Modal ========
  function openResultModal(typeLabel, title, meta, desc, extra, bearText) {
    modalResultTitle.textContent = `ã€${typeLabel}ã€‘${title}`;
    modalResultMeta.textContent  = meta;
    modalResultDesc.textContent  = desc;
    modalResultExtra.textContent = extra;
    modalResultBear.textContent  = bearText;
    modalResult.classList.add("show");
  }
  function closeResult() {
    modalResult.classList.remove("show");
  }
  window.closeResult = closeResult;
  modalResult.addEventListener("click", (e) => {
    if (e.target === modalResult) closeResult();
  });

  // ======== æŠ½æ—…éŠç±¤ ========
  function drawTravel() {
    let list = travelSpots.filter(s => {
      if (currentRegion !== "all" && s.regionKey !== currentRegion) return false;
      if (currentDays < s.daysMin || currentDays > s.daysMax) return false;
      if (currentTarget !== "ä¸é™" && !s.targets.includes(currentTarget)) return false;
      return true;
    });
    if (!list.length) {
      list = travelSpots.filter(s => currentRegion === "all" || s.regionKey === currentRegion);
    }
    if (!list.length) list = travelSpots;
    const picked = list[Math.floor(Math.random()*list.length)];

    const meta =
      `åœ°å€ï¼š${picked.region}ï½œé©åˆå¤©æ•¸ï¼šç´„ ${picked.daysMin}â€“${picked.daysMax} å¤©ï½œæ¨è–¦å°è±¡ï¼š${picked.targets.join("ã€")}`;

    openResultModal("æ—…éŠç±¤", picked.name, meta, picked.desc, picked.extra, picked.bear);

    // è¨ˆæ•¸ & ç´€éŒ„
    todayCounts.travel++;
    updateCountsText();
    saveCounts();

    history.unshift({
      time: new Date().toISOString(),
      type: "æ—…éŠç±¤",
      data: {
        title: picked.name,
        region: picked.region,
        meta,
        desc: picked.desc,
        extra: picked.extra,
        bear: picked.bear
      }
    });
    if (history.length > 120) history.pop();
    saveHistory();
  }

  // ======== æŠ½ç¾é£Ÿç±¤ ========
  function drawFood() {
    let list = foodSpots.filter(f => {
      if (currentRegion === "all") return true;
      return f.regionKey === currentRegion || f.regionKey === "all";
    });
    if (!list.length) list = foodSpots;
    const picked = list[Math.floor(Math.random()*list.length)];

    const meta = `å»ºè­°åœ°å€ï¼š${picked.region}`;
    openResultModal("ç¾é£Ÿç±¤", picked.name, meta, picked.desc, picked.extra, picked.bear);

    todayCounts.food++;
    updateCountsText();
    saveCounts();

    history.unshift({
      time: new Date().toISOString(),
      type: "ç¾é£Ÿç±¤",
      data: {
        title: picked.name,
        region: picked.region,
        meta,
        desc: picked.desc,
        extra: picked.extra,
        bear: picked.bear
      }
    });
    if (history.length > 120) history.pop();
    saveHistory();
  }

  // ======== æŠ½ç±¤æŒ‰éˆ• ========
  btnDraw.addEventListener("click", () => {
    showBearTalk();              // å‡ºéŠç†Šå…ˆé–‹å£èªªè©±
    loadingEl.style.display = "flex";
    btnDraw.disabled = true;

    setTimeout(() => {
      loadingEl.style.display = "none";
      btnDraw.disabled = false;
      if (currentTab === "travel") drawTravel();
      else drawFood();
    }, 800); // å°å°åœé “å¢åŠ æŠ½ç±¤æ„Ÿ
  });

  // ======== ç´€éŒ„ Modal ========
  function openHistory() {
    historyList.innerHTML = "";
    if (!history.length) {
      historyList.innerHTML = '<p class="history-empty">ç›®å‰é‚„æ²’æœ‰ç´€éŒ„ï¼Œå…ˆä¾†æŠ½ä¸€ç±¤å§ï½</p>';
    } else {
      history.slice(0, 50).forEach((item, idx) => {
        const d = new Date(item.time);
        const div = document.createElement("div");
        div.className = "history-item";
        div.dataset.index = idx;
        div.innerHTML = `
          <div class="history-title">ã€${item.type}ã€‘${item.data.title}</div>
          <div class="history-meta">${d.toLocaleString("zh-TW",{hour12:false})}ï½œåœ°å€ï¼š${item.data.region}</div>
        `;
        historyList.appendChild(div);
      });
    }
    modalHistory.classList.add("show");
  }
  function closeHistory() {
    modalHistory.classList.remove("show");
  }
  window.closeHistory = closeHistory;

  btnHistory.addEventListener("click", openHistory);

  // é»ç´€éŒ„ â†’ æ‰“é–‹çµæœè¦–çª—
  historyList.addEventListener("click", (e) => {
    const itemEl = e.target.closest(".history-item");
    if (!itemEl) return;
    const idx = parseInt(itemEl.dataset.index, 10);
    const item = history[idx];
    if (!item) return;
    modalHistory.classList.remove("show");
    openResultModal(item.type, item.data.title, item.data.meta, item.data.desc, item.data.extra, item.data.bear);
  });

  // é»èƒŒæ™¯é—œé–‰ç´€éŒ„
  modalHistory.addEventListener("click", (e) => {
    if (e.target === modalHistory) closeHistory();
  });

  // ======== åˆå§‹åŒ– ========
  function init() {
    setTab("travel");
    setRegion("all");
    updateDayDisplay();
    loadCounts();
    loadHistory();
  }
  init();
</script>
</body>
</html>