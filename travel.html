<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å»å“ªç©åƒä»€éº¼ï½œæ„›åƒç†Šå‡ºéŠç±¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ======= åŸºæœ¬è¨­å®š ======= */
    body {
      margin: 0;
      padding: 0;
      background: #ffb54b;
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
    }
    .app-wrap {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      background: #ffeec9;
      padding: 12px 16px 20px;
      box-sizing: border-box;
    }

    /* ======= Header ======= */
    .header {
      text-align: center;
      margin-bottom: 8px;
    }
    .header h1 {
      margin: 0;
      font-size: 22px;
      color: #7a4329;
    }
    .header p {
      margin: 4px 0 0 0;
      font-size: 13px;
      color: #9b5b36;
    }

    /* ======= ä¸Šæ–¹å¤§åœ–ï¼šå‡ºéŠç†Š + åœ°å€æŒ‰éˆ• ======= */
    .travel-hero-card {
      margin-top: 10px;
      background: #ffe3b1;
      border-radius: 22px;
      padding: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.18);
    }
    .travel-hero-img {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
    }
    .travel-hero-img img {
      width: 100%;
      display: block;
      height: auto;
    }
    .region-chip {
      position: absolute;
      padding: 3px 10px;
      font-size: 12px;
      border-radius: 999px;
      border: 1.5px solid #f5d1a8;
      background: #fffaf2;
      color: #7a4329;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      cursor: pointer;
      white-space: nowrap;
      opacity: 0.95;
    }
    .region-chip.active {
      background: #ffcf98;
      border-color: #f0a96b;
    }
    .region-chip:active {
      transform: scale(0.95);
    }
    /* å¤§åœ–ä¸Šçš„ä½ç½®å¯ä¾ç…§å¯¦éš›åœ–å†å¾®èª¿ */
    .chip-north   { top: 12%; right: 18%; }
    .chip-central { top: 32%; right: 20%; }
    .chip-south   { top: 58%; right: 22%; }
    .chip-east    { top: 30%; left: 70%; }
    .chip-islands { top: 70%; left: 12%; }
    .chip-all     { top: 10%; left: 10%; }

    /* ======= æ¨™é¡Œï¼‹å°æç¤º ======= */
    .section-title {
      margin-top: 14px;
      text-align: center;
    }
    .section-title h2 {
      margin: 0;
      font-size: 20px;
      color: #7a4329;
    }
    .section-title p {
      margin: 4px 0 0 0;
      font-size: 13px;
      color: #9b5b36;
    }

    .hint-bubble {
      margin-top: 12px;
      background: #fffaf2;
      border-radius: 20px;
      border: 1.5px solid #f5d1a8;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.06);
      cursor: pointer;
    }
    .hint-icon {
      font-size: 18px;
    }
    .hint-text {
      font-size: 13px;
      color: #7a4329;
      flex: 1;
    }

    /* ======= åˆ†é åˆ‡æ›ï¼šå»å“ªç© / åƒä»€éº¼ ======= */
    .tab-row {
      margin-top: 12px;
      display: flex;
      background: #ffe3b1;
      border-radius: 999px;
      padding: 3px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .tab-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      background: transparent;
      font-size: 14px;
      color: #9b5b36;
      padding: 8px 0;
      cursor: pointer;
    }
    .tab-btn.active {
      background: #fffaf2;
      color: #7a4329;
      box-shadow: 0 2px 4px rgba(0,0,0,0.12);
    }

    /* ======= é¸é …å€ï¼šå‡ºéŠå°è±¡ + å¤©æ•¸ ======= */
    .options-row {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      align-items: stretch;
    }
    .option-block {
      flex: 1;
      background: #fffaf2;
      border-radius: 16px;
      padding: 10px 10px 8px;
      border: 1.5px solid #f5d1a8;
      box-shadow: 0 3px 8px rgba(0,0,0,0.06);
      font-size: 12px;
      color: #9b5b36;
    }
    .option-title {
      margin-bottom: 6px;
      font-weight: 600;
      color: #7a4329;
      font-size: 13px;
    }
    .target-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .target-chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1.5px solid #f5d1a8;
      background: #fff;
      font-size: 12px;
      color: #7a4329;
      cursor: pointer;
    }
    .target-chip.active {
      background: #ffcf98;
      border-color: #f0a96b;
    }

    .day-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }
    .day-btn {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1.5px solid #f5d1a8;
      background: #fff;
      font-size: 16px;
      color: #7a4329;
      cursor: pointer;
    }
    .day-value {
      min-width: 28px;
      text-align: center;
      font-size: 15px;
      color: #7a4329;
    }
    .day-note {
      margin-top: 2px;
      font-size: 11px;
      color: #b07a50;
    }

    /* ======= çµæœå¡ç‰‡ ======= */
    .result-card {
      margin-top: 14px;
      background: #fffaf2;
      border-radius: 18px;
      border: 1.5px solid #f5d1a8;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      padding: 10px 12px 12px;
      font-size: 13px;
      color: #7a4329;
    }
    .result-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .result-region {
      font-size: 12px;
      color: #b07a50;
      margin-bottom: 6px;
    }
    .result-desc {
      margin-bottom: 4px;
      line-height: 1.6;
    }
    .result-secret {
      font-size: 12px;
      color: #b07a50;
      margin-bottom: 4px;
    }
    .result-bear {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 12px;
      background: #fff1d6;
      border: 1px dashed #f0c57a;
      font-size: 12px;
      white-space: pre-line;
    }

    /* ======= æŠ½ç±¤æŒ‰éˆ• + ä»Šæ—¥æ¬¡æ•¸ ======= */
    .action-row {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .btn-draw {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 12px;
      font-size: 15px;
      font-weight: 600;
      color: #7a4329;
      background: linear-gradient(90deg, #ffb46f, #ff8f6b);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: pointer;
    }
    .btn-draw:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }

    .today-count {
      font-size: 12px;
      color: #9b5b36;
      text-align: right;
    }

    .record-row {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .btn-record {
      border-radius: 999px;
      border: 1.5px dashed #f0a96b;
      background: #fffaf2;
      padding: 6px 10px;
      font-size: 12px;
      color: #7a4329;
      cursor: pointer;
    }

    /* ======= Loading ======= */
    .loading {
      margin-top: 8px;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 12px;
      color: #9b5b36;
    }
    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #ff9f6b;
      animation: bounce 0.8s infinite alternate;
    }
    .dot:nth-child(2) { animation-delay: 0.15s; }
    .dot:nth-child(3) { animation-delay: 0.3s; }
    @keyframes bounce {
      from { transform: translateY(0); opacity: 0.4; }
      to   { transform: translateY(-6px); opacity: 1; }
    }

    /* ======= Modal ======= */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-backdrop.show { display: flex; }

    .modal-window {
      width: 88%;
      max-width: 420px;
      max-height: 80vh;
      overflow-y: auto;
      background: #fff7e6;
      border-radius: 18px;
      border: 2px solid #f3c690;
      padding: 14px 18px 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      position: relative;
    }
    .modal-close {
      position: absolute;
      right: 12px;
      top: 8px;
      font-size: 20px;
      background: none;
      border: none;
      color: #7a4329;
      cursor: pointer;
    }
    .modal-window h3 {
      margin: 4px 0 6px 0;
      font-size: 18px;
      color: #7a4329;
    }

    /* ç´€éŒ„åˆ—è¡¨ */
    #historyList {
      font-size: 13px;
      color: #7a4329;
    }
    .history-item {
      padding: 8px 0;
      border-bottom: 1px dashed #e8c08d;
      cursor: pointer;
    }
    .history-item:last-child { border-bottom: none; }
    .history-title {
      font-weight: 600;
    }
    .history-meta {
      font-size: 11px;
      color: #b07a50;
    }

    .history-detail {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #f3c690;
      font-size: 13px;
    }

    @media (max-width: 380px) {
      .header h1 { font-size: 20px; }
      .section-title h2 { font-size: 18px; }
      .option-block { padding: 8px; }
      .btn-draw { font-size: 14px; }
    }
  </style>
</head>
<body>
<div class="app-wrap">
  <header class="header">
    <h1>å»å“ªç©åƒä»€éº¼</h1>
    <p>è®“å‡ºéŠç†Šå¹«ä½ æŠ½å‡ºæ—…éŠæ™¯é» & ç¾é£Ÿéˆæ„Ÿ</p>
  </header>

  <!-- ä¸Šæ–¹å¤§åœ–ï¼šå‡ºéŠç†Š + å°ç£åœ°åœ– -->
  <section class="travel-hero-card">
    <div class="travel-hero-img">
      <img src="images/travel.png" alt="å‡ºéŠç†Šå»å“ªç©">

      <button class="region-chip chip-all active"     id="btnAll">å…¨å°</button>
      <button class="region-chip chip-north"   id="btnNorth">åŒ—éƒ¨</button>
      <button class="region-chip chip-central" id="btnCentral">ä¸­éƒ¨</button>
      <button class="region-chip chip-south"   id="btnSouth">å—éƒ¨</button>
      <button class="region-chip chip-east"    id="btnEast">æ±éƒ¨</button>
      <button class="region-chip chip-islands" id="btnIslands">å¤–å³¶</button>
    </div>
  </section>

  <!-- æ¨™é¡Œ & å°æç¤º -->
  <section class="section-title">
    <h2>å»å“ªç©åƒä»€éº¼</h2>
    <p>æŒ‰å°ç£åœ°åœ–é¸åœ°é»ï¼Œè®“æ„›åƒç†Šå¹«ä½ æŠ½å‡ºæ—…éŠ & ç¾é£Ÿéˆæ„Ÿ ğŸ»</p>
  </section>

  <div class="hint-bubble" id="btnHint">
    <span class="hint-icon">ğŸ»</span>
    <span class="hint-text" id="hintText">é»æˆ‘ä¸€ä¸‹ï¼Œè½è½ä»Šå¤©æ„›åƒç†Šçš„å°æç¤ºï½</span>
  </div>

  <!-- åˆ†é åˆ‡æ› -->
  <div class="tab-row">
    <button class="tab-btn active" id="tabTravel">å»å“ªç©</button>
    <button class="tab-btn" id="tabFood">åƒä»€éº¼</button>
  </div>

  <!-- é¸é …å€ -->
  <div class="options-row">
    <div class="option-block">
      <div class="option-title">å‡ºéŠå°è±¡</div>
      <div class="target-chip-row">
        <button class="target-chip active" data-target="ä¸é™">ä¸é™</button>
        <button class="target-chip" data-target="è¦ªå­">è¦ªå­</button>
        <button class="target-chip" data-target="æƒ…ä¾¶">æƒ…ä¾¶</button>
        <button class="target-chip" data-target="å¤§äººæ”¾é¬†">å¤§äººæ”¾é¬†</button>
        <button class="target-chip" data-target="ä¸€å€‹äºº">ä¸€å€‹äºº</button>
      </div>
    </div>
    <div class="option-block">
      <div class="option-title">ç©å¹¾å¤©</div>
      <div class="day-row">
        <button class="day-btn" id="dayMinus">-</button>
        <div class="day-value" id="dayValue">2</div>
        <button class="day-btn" id="dayPlus">+</button>
      </div>
      <div class="day-note">(1â€“5 å¤©ï¼Œå°æ—…è¡Œæœ€å‰›å¥½)</div>
    </div>
  </div>

  <!-- çµæœå¡ç‰‡ -->
  <div class="result-card" id="resultCard" style="display:none;">
    <div class="result-title" id="resultTitle"></div>
    <div class="result-region" id="resultRegion"></div>
    <div class="result-desc" id="resultDesc"></div>
    <div class="result-secret" id="resultExtra"></div>
    <div class="result-bear" id="resultBear"></div>
  </div>

  <!-- æŠ½ç±¤ & è¨ˆæ•¸ -->
  <div class="action-row">
    <button class="btn-draw" id="btnDraw">æŠ½æ—…éŠç±¤ âœ¨</button>

    <div class="loading" id="loading">
      æ„›åƒç†Šå¹«ä½ æŠ½ç±¤ä¸­â€¦
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>

    <div class="today-count" id="todayCountText">
      ä»Šæ—¥æ—…éŠç±¤ï¼š0 æ¬¡ã€€ï½œã€€ä»Šæ—¥ç¾é£Ÿç±¤ï¼š0 æ¬¡
    </div>

    <div class="record-row">
      <button class="btn-record" id="btnHistory">æŸ¥çœ‹ç´€éŒ„ ğŸ“š</button>
    </div>
  </div>
</div>

<!-- ç´€éŒ„ Modal -->
<div class="modal-backdrop" id="modalHistory">
  <div class="modal-window">
    <button class="modal-close" onclick="closeHistory()">âœ•</button>
    <h3>å‡ºéŠèˆ‡ç¾é£Ÿç´€éŒ„</h3>
    <p style="font-size:12px;color:#b07a50;margin:0 0 6px 0;">é»é¸ä¸€ç­†ç´€éŒ„ï¼Œå¯ä»¥é‡æ–°æŸ¥çœ‹ç•¶æ™‚çš„å‡ºéŠ / ç¾é£Ÿå»ºè­°ã€‚</p>
    <div id="historyList"></div>
    <div class="history-detail" id="historyDetail" style="display:none;"></div>
  </div>
</div>

<script>
  // ======== å°æç¤ºèªéŒ„ ========
  const hints = [
    "æ—…è¡Œä¸ä¸€å®šè¦è·‘å¾ˆé ï¼Œåªè¦æœ‰ä¸€å€‹è®“ä½ æ”¾é¬†çš„åœ°æ–¹ï¼Œå°±ç®—æ˜¯å†’éšªã€‚",
    "ä»Šå¤©ä¹Ÿè¦è¨˜å¾—è£œæ°´ã€å¤šä¼‘æ¯ï¼Œç©æ¨‚çš„é«”åŠ›å°±æ˜¯å¾å¥½å¥½ä¼‘æ¯ä¾†çš„ã€‚",
    "ä¸ä¸€å®šè¦æ‹å¾ˆå¤šç…§ç‰‡ï¼Œç•™ä¸€é»æ™‚é–“åªæŠŠé¢¨æ™¯æ”¾åœ¨å¿ƒè£¡å°±å¥½ã€‚",
    "å’Œèª°ä¸€èµ·å»ï¼Œæ¯”å»å“ªè£¡æ›´é‡è¦ã€‚ä¹Ÿå¯ä»¥é¸æ“‡è·Ÿè‡ªå·±å¥½å¥½ç´„æœƒã€‚",
    "å¦‚æœå¤©æ°£ä¸å¥½ï¼Œå°±æ”¹æˆç¾é£Ÿå°æ—…è¡Œä¹Ÿå¾ˆæ£’ã€‚",
    "è¡Œç¨‹æ’é¬†ä¸€é»ï¼Œçµ¦è‡ªå·±å¤šä¸€é»ã€ä»€éº¼éƒ½ä¸åšã€çš„ç©ºæ ¼ã€‚",
    "å­©å­åµé¬§æ²’é—œä¿‚ï¼Œä»£è¡¨ä»–å€‘åœ¨ç”¨è‡ªå·±çš„æ–¹å¼æ„Ÿå—ä¸–ç•Œã€‚",
    "æ—…è¡Œé ç®—å¯ä»¥å°å°çš„ï¼Œä½†å–„å¾…è‡ªå·±çš„å¿ƒæ„å¯ä»¥å¾ˆå¤§ã€‚",
    "è¿·è·¯æœ‰æ™‚å€™ä¸æ˜¯å£äº‹ï¼Œå¯èƒ½æœƒèµ°é€²æ–°çš„é©šå–œã€‚",
    "ç©ç´¯äº†å°±æ‰¾é–“å’–å•¡å»³åä¸€ä¸‹ï¼Œä»€éº¼éƒ½ä¸åšä¹Ÿæ˜¯ä¸€ç¨®æ—…è¡Œã€‚"
  ];

  // ======== æ—…éŠæ™¯é»è³‡æ–™ ========
  const travelSpots = [
    // åŒ—éƒ¨
    {
      region: "åŒ—éƒ¨",
      regionKey: "north",
      name: "é™½æ˜å±±å¤œæ™¯ & æº«æ³‰å°æ—…è¡Œ",
      daysMin: 1, daysMax: 2,
      targets: ["ä¸é™","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "ç™½å¤©ä¸Šå±±æ•£æ­¥çœ‹èŠ±ï¼Œæ™šä¸Šæ³¡æº«æ³‰ã€çœ‹å°åŒ—å¤œæ™¯ï¼Œå¾ˆé©åˆæƒ³æ”¾é¬†åˆä¸æƒ³è·‘å¤ªé çš„è¡Œç¨‹ã€‚",
      extra: "ç§˜å¢ƒå°è§’è½ï¼šç«¹å­æ¹–çš„æ­¥é“æ¯”è¼ƒå®‰éœï¼Œå¯ä»¥æ…¢æ…¢æ•£æ­¥ã€æ‹ç…§ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šå±±ä¸Šæ—©æ™šæº«å·®å¤§ï¼Œè¨˜å¾—å¸¶ä»¶å¤–å¥—ï¼›æƒ³æ‹ç…§çš„è©±ï¼Œè¡Œç¨‹åˆ¥æ’å¤ªæ»¿ï¼Œç•™çµ¦å¤•é™½ä¸€é»æ™‚é–“ã€‚"
    },
    {
      region: "åŒ—éƒ¨",
      regionKey: "north",
      name: "ä¹ä»½è€è¡— & é‡‘ç“œçŸ³å±±åŸæ•£æ­¥",
      daysMin: 1, daysMax: 2,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº"],
      desc: "èµ°é€²å±±åŸå°å··ï¼Œé€›è€è¡—ã€åƒèŠ‹åœ“ï¼Œçœ‹å±±æµ·äº¤ç•Œï¼Œå¤©æ°£å¥½æ™‚é æ–¹æµ·æ™¯è¶…ç™‚ç™’ã€‚",
      extra: "ç§˜å¢ƒæ¨è–¦ï¼šå¯ä»¥å¾€å±±ä¸Šå†èµ°ä¸€å°æ®µï¼Œé¿é–‹äººæ½®æœƒæœ‰æ¯”è¼ƒå®‰éœçš„è§€æ™¯å¹³å°ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šå±±è·¯å¤šæ¨“æ¢¯ï¼Œé‹å­è¨˜å¾—ç©¿å¥½èµ°çš„ï¼Œè‚šå­é¤“æ™‚è€è¡—å°åƒéš¨ä¾¿ä¸€é–“éƒ½å¾ˆå¥½åƒã€‚"
    },
    {
      region: "åŒ—éƒ¨",
      regionKey: "north",
      name: "æ·¡æ°´æ²³ç•”å¤•é™½æ•£æ­¥",
      daysMin: 1, daysMax: 1,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº"],
      desc: "æ­æ·é‹å°±èƒ½åˆ°ï¼Œæ²³å²¸æ•£æ­¥ã€åƒå°åƒï¼Œå¤©æ°£å¥½æ™‚å¤•é™½ç‘åœ¨æ²³é¢ä¸Šè¶…ç¾ã€‚",
      extra: "å°ç§˜å¢ƒï¼šå¯ä»¥æ²¿è‘—æ²³å²¸å†å¾€é—œæ¸¡ã€å…«é‡Œæ–¹å‘èµ°ï¼Œäººæ½®æœƒæ…¢æ…¢è®Šå°‘ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šè¨˜å¾—å¸¶ä»¶è–„å¤–å¥—ï¼Œå¤•é™½å¾Œé¢¨æœƒè®Šæ¶¼ï¼Œå¯ä»¥é †ä¾¿å®‰æ’æ²³ç•”è…³è¸è»Šå°é‹å‹•ã€‚"
    },
    // ä¸­éƒ¨
    {
      region: "ä¸­éƒ¨",
      regionKey: "central",
      name: "å°ä¸­å¯©è¨ˆæ–°æ‘ & è‰æ‚Ÿé“ä¸€æ—¥æ•£æ­¥",
      daysMin: 1, daysMax: 2,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº","å¤§äººæ”¾é¬†"],
      desc: "æ–‡å‰µå°åº—ã€ç¾é£Ÿèˆ‡ç¶ æ¨¹æ­¥é“ï¼Œä¸€æ•´å¤©æ…¢æ…¢é€›ã€ä¸è¶•æ™‚é–“ä¹Ÿä¸ç„¡èŠã€‚",
      extra: "ç§˜å¢ƒï¼šè‰æ‚Ÿé“æ—é‚Šçš„å°å··å’–å•¡é¤¨å¾ˆå¤šï¼Œé¸ä¸€é–“å–œæ­¡çš„çª—é‚Šåä¸‹ä¾†æ”¾ç©ºã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šå¯ä»¥å¸¶ä¸€æœ¬æ›¸æˆ–ç­†è¨˜æœ¬ï¼Œä¸€é‚Šå–å’–å•¡ä¸€é‚Šå¯«ä¸‹æ­¤åˆ»çš„å¿ƒæƒ…ã€‚"
    },
    {
      region: "ä¸­éƒ¨",
      regionKey: "central",
      name: "åˆæ­¡å±±çœ‹æ˜Ÿæ˜Ÿ & æ—¥å‡º",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "æ™šä¸Šçœ‹æ»¿å¤©æ˜Ÿæ˜Ÿï¼Œæ¸…æ™¨çœ‹æ—¥å‡ºå¾å±±é ­å†’å‡ºä¾†ï¼Œè¶…ç´šç™‚ç™’ï¼Œä½†éœ€è¦ä¸€é»é«”åŠ›èˆ‡ä¿æš–è£å‚™ã€‚",
      extra: "ç§˜å¢ƒå»ºè­°ï¼šé¿é–‹é€£å‡ï¼Œé¸å¹³æ—¥èˆ‡éç†±é–€æ™‚æ®µï¼Œå±±ä¸Šçš„æ˜Ÿç©ºæœƒæ›´å®‰éœã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šå±±ä¸Šå†·åˆ°æœƒå‡ç†Šï¼Œè«‹å¸¶åšå¤–å¥—ã€å¸½å­ã€æ‰‹å¥—ï¼Œè¡Œç¨‹å‰ä¸€æ™šè¦ç¡é£½ä¸€é»ã€‚"
    },
    // å—éƒ¨
    {
      region: "å—éƒ¨",
      regionKey: "south",
      name: "å¢¾ä¸è—å¤©ç™½é›²æµ·é‚Šè¡Œç¨‹",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†"],
      desc: "ç™½å¤©æˆ²æ°´ã€æ•£æ­¥ï¼Œæ™šä¸Šé€›å¤§è¡—åƒæµ·ç”¢ï¼Œé©åˆæƒ³æ›¬å¤ªé™½ã€æ”¾ç©ºçš„å¤§äººå°å­©ã€‚",
      extra: "ç§˜å¢ƒæµ·é‚Šï¼šå¯ä»¥æ‰¾é›¢å¤§è¡—é ä¸€é»çš„æ²™ç˜ï¼Œäººæœƒå°‘å¾ˆå¤šï¼Œæ›´æœ‰åº¦å‡æ„Ÿã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šé˜²æ›¬ä¸€å®šè¦æ“¦ï¼Œå¸½å­å¢¨é¡ä¹Ÿå¸¶ä¸Šï¼Œç©æ°´å‰å¾Œå¤šè£œæ°´ï¼Œä¸è¦è®“è‡ªå·±è®Šæˆä¹¾ç†Šã€‚"
    },
    {
      region: "å—éƒ¨",
      regionKey: "south",
      name: "å°å—è€è¡—å··å¼„ç¾é£Ÿå°æ—…è¡Œ",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","ä¸€å€‹äºº"],
      desc: "ç™½å¤©é€›å¤è¹Ÿã€å–å’–å•¡ï¼Œæ™šä¸Šå·¡è¿´å„ç¨®å°åƒï¼Œé©åˆæ…¢æ…¢èµ°æ…¢æ…¢åƒçš„æ—…è¡Œã€‚",
      extra: "ç§˜å¢ƒè§’è½ï¼šå··å­è£¡å¾ˆå¤šè€æˆ¿æ”¹å»ºçš„å°åº—ï¼Œå¯ä»¥éš¨æ©Ÿèµ°é€²å»æ¢ç´¢ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šä¸è¦ä¸€æ¬¡æ’å¤ªå¤šåº—ï¼Œåƒåˆ°ä¸ƒåˆ†é£½å°±ä¼‘æ¯ï¼Œç•™ç©ºé–“çµ¦ä¸‹ä¸€å®¶é©šå–œã€‚"
    },
    // æ±éƒ¨
    {
      region: "æ±éƒ¨",
      regionKey: "east",
      name: "èŠ±è“®æµ·å²¸ç·šè‡ªé§•æ•£å¿ƒ",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "ä¸€è·¯çœ‹æµ·ã€åœé å°å’–å•¡é¤¨èˆ‡è§€æ™¯å°ï¼Œé©åˆæƒ³å¤§å£å‘¼å¸æµ·é¢¨çš„äººã€‚",
      extra: "ç§˜å¢ƒï¼šæµ·å²¸é‚Šæœ‰äº›å°è·¯å¯ä»¥èµ°åˆ°è¼ƒå®‰éœçš„ç¤«çŸ³ç˜ï¼Œè¨˜å¾—æ³¨æ„å®‰å…¨èˆ‡æ½®æ±ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šé–‹è»Šæˆ–é¨è»Šæ™‚ä¸è¦å¤ªè¶•æ™‚é–“ï¼Œæœ‰æ¼‚äº®çš„é¢¨æ™¯å°±æ‰¾å®‰å…¨çš„åœ°æ–¹åœä¸‹ä¾†å¥½å¥½çœ‹ã€‚"
    },
    {
      region: "æ±éƒ¨",
      regionKey: "east",
      name: "å°æ±ç†±æ°£çƒ & é¹¿é‡é«˜å°",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†"],
      desc: "å¤å­£é™å®šæ´»å‹•ï¼Œçœ‹ç†±æ°£çƒå‡ç©ºã€é‡é¤ã€æ‹ç…§ï¼Œæ•´å€‹æ°£æ°›è¶…å¤¢å¹»ã€‚",
      extra: "ç§˜å¢ƒå»ºè­°ï¼šé¿é–‹æ­£ä¸­åˆäººæ½®ï¼Œæ¸…æ™¨æˆ–å‚æ™šçš„å…‰ç·šæ¯”è¼ƒæŸ”å’Œï¼Œä¹Ÿæ¯”è¼ƒä¸ç†±ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šè¨˜å¾—å¸¶é‡é¤å¢Šã€é˜²èšŠæ¶²èˆ‡å¸½å­ï¼Œæ’éšŠçš„æ™‚å€™å¯ä»¥ç©å°éŠæˆ²æ‰“ç™¼æ™‚é–“ã€‚"
    },
    // å¤–å³¶
    {
      region: "å¤–å³¶",
      regionKey: "islands",
      name: "æ¾æ¹–è·³å³¶çœ‹è—æµ·",
      daysMin: 3, daysMax: 4,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†"],
      desc: "åƒåŠ è·³å³¶è¡Œç¨‹ã€æµ®æ½›ã€çœ‹ç„æ­¦å²©èˆ‡å¤•é™½ï¼Œæ˜¯å¾ˆæœ‰åº¦å‡æ„Ÿçš„æµ·å³¶æ—…ç¨‹ã€‚",
      extra: "å°ç§˜å¢ƒï¼šæœ‰äº›å°å³¶ä¸Šçš„å°æ¼æ‘å¾ˆå®‰éœï¼Œå¯ä»¥æ…¢æ…¢æ•£æ­¥ã€è½æµ·è²ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šæµ·å³¶ç´«å¤–ç·šè¶…å¼·ï¼Œé˜²æ›¬èˆ‡è£œæ°´è¦æ¯”å¹³å¸¸å†èªçœŸä¸€é»ï¼›æƒ³ç©æ°´å‹™å¿…æ³¨æ„å®‰å…¨ã€‚"
    },
    {
      region: "å¤–å³¶",
      regionKey: "islands",
      name: "é‡‘é–€è€å±‹æ…¢æ´»ä¹‹æ—…",
      daysMin: 2, daysMax: 3,
      targets: ["ä¸é™","è¦ªå­","æƒ…ä¾¶","å¤§äººæ”¾é¬†","ä¸€å€‹äºº"],
      desc: "å¤åã€æˆ°åœ°æ™¯é»èˆ‡åœ¨åœ°å°åƒï¼Œå¯ä»¥æ„Ÿå—ä¸ä¸€æ¨£çš„æ­·å²æ„Ÿæ—…è¡Œã€‚",
      extra: "ç§˜å¢ƒè§’è½ï¼šå‚æ™šæ™‚åˆ°è€å±‹é™„è¿‘æ•£æ­¥ï¼Œå¤•é™½ç‘åœ¨ç´…ç£šç‰†ä¸Šéå¸¸æ¼‚äº®ã€‚",
      bear: "ğŸ» ç†Šç†Šè²¼å¿ƒå®åš€ï¼šå¯ä»¥å’Œåœ¨åœ°åº—å®¶èŠèŠï¼Œå¸¸å¸¸æœƒè½åˆ°å¾ˆå¤šæœ‰è¶£çš„æ•…äº‹ã€‚"
    }
  ];

  // ======== ç¾é£Ÿæ¸…å–®ï¼ˆå„åœ°ç‰¹è‰²ï¼‹ä¸€é»ç§˜å¢ƒæ„Ÿï¼‰ ========
  const foodSpots = [
    {
      region: "åŒ—éƒ¨",
      regionKey: "north",
      name: "å°åŒ—å··å£ç‰›è‚‰éºµ",
      desc: "æ‰¾ä¸€é–“åœ¨åœ°äººæ„›çš„è€åº—ï¼Œä¾†ä¸€ç¢—ç´…ç‡’æ¹¯é ­é…é…¸èœï¼Œæš–èƒƒä¹Ÿæš–å¿ƒã€‚",
      extra: "å°ç§˜è¨£ï¼šå¯ä»¥è©¦è©¦åŠç­‹åŠè‚‰æˆ–åŠ ä¸€é¡†æ»·è›‹ï¼Œæ•´ç¢—æ»¿è¶³åº¦ç¬é–“å‡ç´šã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šåƒå®Œèµ°ä¸€å°æ®µè·¯å›å®¶ï¼Œè®“è‚šå­æœ‰æ™‚é–“å¥½å¥½æ¶ˆåŒ–ã€‚"
    },
    {
      region: "åŒ—éƒ¨",
      regionKey: "north",
      name: "åŸºéš†å»Ÿå£å¤œå¸‚å°åƒå·¡ç¦®",
      desc: "å¾å¤©å©¦ç¾…ã€ç‡Ÿé¤Šä¸‰æ˜æ²»ä¸€è·¯åƒåˆ°ç”œæ¹¯ï¼Œé©åˆå˜´å·´æƒ³ä¸€ç›´å¿™ç¢Œçš„æ—¥å­ã€‚",
      extra: "ç§˜å¢ƒåº—å®¶ï¼šå¯ä»¥å¾€å··å­è£¡æ¢éšªï¼Œå¸¸å¸¸æœƒé‡åˆ°æ²’æœ‰æ’éšŠå»å¾ˆå¥½åƒçš„å°æ”¤ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå¤œå¸‚ä¸€æ¬¡æƒ³åƒå¾ˆå¤šç¨®ï¼Œå»ºè­°åˆ†äº«è‘—åƒï¼Œè‚šå­è·Ÿè·åŒ…éƒ½æ¯”è¼ƒé–‹å¿ƒã€‚"
    },
    {
      region: "ä¸­éƒ¨",
      regionKey: "central",
      name: "å°ä¸­é€¢ç”²æˆ–ä¸€ä¸­ç¾é£Ÿåœ°åœ–",
      desc: "é›æ’ã€åœ°ç“œçƒã€å‰µæ„é£²æ–™â€¦ä¸€è·¯åƒä¸€è·¯é€›ï¼Œé€›å®Œé‚„èƒ½é †è·¯è²·è¡£æœã€‚",
      extra: "å°å»ºè­°ï¼šå…ˆæƒ³å¥½ä»Šå¤©ä¸€å®šè¦åƒçš„ä¸‰æ¨£ï¼Œå…¶å®ƒçœ‹åˆ°å†åŠ ï¼Œæ˜¯æ¯”è¼ƒä¸æœƒåƒåˆ°çˆ†ç‚¸çš„æ–¹å¼ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä¸ä¸€å®šè¦æ’å¾ˆå¤šåº—ï¼Œåªè¦æœ‰åƒåˆ°å¿ƒè£¡æœ€æƒ³å¿µçš„é‚£å¹¾å€‹å°±å¾ˆå€¼å¾—ã€‚"
    },
    {
      region: "ä¸­éƒ¨",
      regionKey: "central",
      name: "å½°åŒ–è‚‰åœ“ & éŠ…æ¿å°åƒ",
      desc: "è»ŸQå¤–çš®é…ä¸Šæ‰å¯¦è‚‰é¤¡ï¼Œå†æ­ä¸€ç¢—æ¹¯æˆ–ç±³ç³•ï¼Œæ˜¯åœ¨åœ°äººå¾ˆæ„›çš„æ—¥å¸¸å‘³ã€‚",
      extra: "ç§˜å¢ƒé«”é©—ï¼šå¯ä»¥æ‰¾è€è¡—é™„è¿‘çš„å°åƒåº—ï¼Œå¸¸å¸¸æœƒæœ‰éš±è—ç‰ˆèœå–®ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šåƒçš„æ™‚å€™å°ˆå¿ƒäº«å—ï¼Œä¹‹å¾Œå†æ…¢æ…¢èµ°è·¯æ¶ˆåŒ–å°±å¥½ã€‚"
    },
    {
      region: "å—éƒ¨",
      regionKey: "south",
      name: "å°å—æ—©åˆé¤ï¼šç‰›è‚‰æ¹¯ + é‹ç‡’æ„éºµ",
      desc: "ä¸€å¤§æ—©å–ä¸€ç¢—ç‰›è‚‰æ¹¯ï¼Œå†åƒé‹ç‡’æ„éºµï¼Œå—éƒ¨äººçš„æ—¥å¸¸å„€å¼ä¸€æ¬¡é«”é©—å®Œã€‚",
      extra: "ç§˜å¢ƒï¼šå¾ˆå¤šç‰›è‚‰æ¹¯åº—æ˜¯å‡Œæ™¨å°±é–‹å§‹ç‡Ÿæ¥­ï¼Œè¶Šæ—©è¶Šæœ‰åœ¨åœ°æ„Ÿã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šè¨˜å¾—å¤šå–æ°´ï¼Œé †ä¾¿æ•£æ­¥èµ°èµ°ï¼Œè®“è‚šå­æœ‰ç©ºé–“ç¹¼çºŒåƒä¸‹ä¸€æ”¤ã€‚"
    },
    {
      region: "å—éƒ¨",
      regionKey: "south",
      name: "é«˜é›„é¹½åŸ•æˆ–é§äºŒé€±é‚Šç”œé»å·¡ç¦®",
      desc: "è€æ¸¯éƒ½å€ç¾åœ¨æœ‰å¾ˆå¤šç‰¹è‰²å’–å•¡é¤¨èˆ‡ç”œé»åº—ï¼Œå¾ˆé©åˆæ‹ç…§æ”¾ç©ºã€‚",
      extra: "å°ç§˜å¢ƒï¼šæ‰¾ä¸€é–“çª—é‚Šå¯ä»¥çœ‹åˆ°æ¸¯å£æˆ–éµé“çš„åº§ä½ï¼Œæ™‚é–“æœƒè®Šå¾—å¾ˆæ…¢ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šç”œé»ä¸æ˜¯ç½ªæƒ¡ï¼Œæ˜¯çµ¦åŠªåŠ›ç”Ÿæ´»çš„è‡ªå·±ä¸€é»çå‹µã€‚"
    },
    {
      region: "æ±éƒ¨",
      regionKey: "east",
      name: "èŠ±è“®éº»ç³¬ + å…¬æ­£åŒ…å­ + ç‚¸è›‹è”¥æ²¹é¤…",
      desc: "æŠŠæœ‰åçš„å°é»æ’æˆä¸€æ¢è·¯ç·šï¼Œä¸€é‚Šæ•£æ­¥ä¸€é‚Šåƒï¼ŒæŠŠè¡Œç¨‹è®Šæˆç¾é£Ÿèµ°è®€ã€‚",
      extra: "ç§˜å¢ƒé»å¿ƒï¼šå¾ˆå¤šè·¯é‚Šå°éº»ç³¬åº—æ²’æœ‰æ’éšŠä¹Ÿå¾ˆå¥½åƒï¼Œå¯ä»¥éš¨æ©Ÿé¸ä¸€å®¶è©¦è©¦ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå¸¶è‘—é£Ÿç‰©å»æµ·é‚Šåè‘—åƒï¼Œå°å¿ƒé¢¨å¤§ä½†æ°£æ°›è¶…ç™‚ç™’ã€‚"
    },
    {
      region: "æ±éƒ¨",
      regionKey: "east",
      name: "å°æ±åœ¨åœ°é‡‹è¿¦ & ç†±å¸¶æ°´æœç›¤",
      desc: "åœ¨ç”¢åœ°åƒç•¶å­£æ°´æœï¼Œç”œåº¦è·Ÿé¦™æ°£éƒ½è¶…æœ‰å­˜åœ¨æ„Ÿã€‚",
      extra: "å°æé†’ï¼šå¯ä»¥è«‹åº—å®¶å¹«å¿™åˆ‡å¥½è£ç›’ï¼Œå›æ°‘å®¿å†°è‘—æ…¢æ…¢åƒã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ°´æœä¹Ÿæœ‰ç†±é‡ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šç‡Ÿé¤Šï¼Œç•¶æˆå°èº«é«”å¥½çš„é»å¿ƒå°±å¾ˆæ£’ã€‚"
    },
    {
      region: "å¤–å³¶",
      regionKey: "islands",
      name: "æ¾æ¹–æµ·é®®å¤§é¤",
      desc: "æ–°é®®é­šã€èŠ±æã€èƒèŸ¹é€šé€šä¸Šæ¡Œï¼Œæµ·é¢¨+æµ·é®®çš„çµ„åˆæ ¹æœ¬æ˜¯åº¦å‡å‘³é“ã€‚",
      extra: "ç§˜å¢ƒå°åº—ï¼šå¯ä»¥å•æ°‘å®¿è€é—†æ„›åƒå“ªä¸€å®¶ï¼Œé€šå¸¸éƒ½ä¸æœƒè¸©é›·ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šå¤¾èœæ™‚å¯ä»¥å¹«è‡ªå·±å¤šå¤¾ä¸€é»è”¬èœï¼Œè…¸èƒƒæœƒæ›´èˆ’æœã€‚"
    },
    {
      region: "å¤–å³¶",
      regionKey: "islands",
      name: "é‡‘é–€è²¢ç³– & éºµç·šç³Š",
      desc: "æ—©é¤åƒä¸€ç¢—éºµç·šç³Šï¼Œä¸‹åˆä¾†å¹¾å¡Šè²¢ç³–ï¼Œæ˜¯å¾ˆé‡‘é–€å‘³çš„çµ„åˆã€‚",
      extra: "å°å»ºè­°ï¼šè²¢ç³–é©åˆåˆ†äº«ï¼Œä¸€äººåƒä¸€é»é»ï¼Œç”œä»½å°±å‰›å‰›å¥½ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šä¼´æ‰‹ç¦®ä¸ç”¨è²·å¤ªå¤šï¼ŒæŒ‘è‡ªå·±çœŸçš„æœƒæƒ³åƒå®Œçš„å°±å¥½ã€‚"
    },
    // å…¨å°é€šç”¨ç¾é£Ÿ
    {
      region: "å…¨å°",
      regionKey: "all",
      name: "çç å¥¶èŒ¶ & æ‰‹æ–é£²å°ç¢ºå¹¸",
      desc: "æŒ‘ä¸€æ¯ä½ å–œæ­¡çš„æ‰‹æ–é£²ï¼Œä»Šå¤©å¯ä»¥é¸åŠç³–æˆ–å°‘å†°ï¼Œçµ¦èº«é«”ä¸€é»æº«æŸ”ã€‚",
      extra: "å°ä»»å‹™ï¼šå–é£²æ–™æ™‚åˆ»æ„æ”¾æ…¢é€Ÿåº¦ï¼Œé‚Šå–é‚Šæ„Ÿè¬ä»Šå¤©é‚„åœ¨åŠªåŠ›çš„è‡ªå·±ã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šç”œåº¦å°‘ä¸€é»ï¼Œç½ªæƒ¡æ„Ÿä¹Ÿæœƒå°‘ä¸€é»ï¼Œä½†å¹¸ç¦æ„Ÿé‚„æ˜¯å¾ˆå¤šã€‚"
    },
    {
      region: "å…¨å°",
      regionKey: "all",
      name: "å¸‚å ´è£¡çš„éš±è—æ—©é¤æ”¤",
      desc: "æ—©èµ·åˆ°èœå¸‚å ´ï¼Œåœ¨åœ°çš„è±†æ¼¿ã€é£¯ç³°ã€è˜¿è””ç³•å¾€å¾€éƒ½å¾ˆå²å®³ã€‚",
      extra: "ç§˜å¢ƒé«”é©—ï¼šæ‰¾ä¸€æ”¤è€é—†æœƒè·Ÿå®¢äººèŠå¤©çš„ï¼Œæœƒæ›´æœ‰åœ¨åœ°ç”Ÿæ´»æ„Ÿã€‚",
      bear: "ğŸ» ç†Šç†Šèªªï¼šæ—©èµ·åƒæ—©é¤å¾ˆè¾›è‹¦ï¼Œä½†é‚£ä¹Ÿæ˜¯ä¸€ç¨®ã€æˆ‘æœ‰å¥½å¥½ç…§é¡§è‡ªå·±ã€çš„è­‰æ˜ã€‚"
    }
  ];

  // ======== ç‹€æ…‹ ========
  let currentTab = "travel"; // travel | food
  let currentRegion = "all"; // all | north | central | south | east | islands
  let currentTarget = "ä¸é™";
  let currentDays = 2;

  const STORAGE_COUNTS = "travel_today_counts";
  const STORAGE_HISTORY = "travel_history";

  let todayCounts = { date: "", travel: 0, food: 0 };
  let history = []; // {time, type, data}

  // ======== DOM ========
  const hintBtn   = document.getElementById("btnHint");
  const hintTextEl= document.getElementById("hintText");

  const tabTravel = document.getElementById("tabTravel");
  const tabFood   = document.getElementById("tabFood");
  const btnDraw   = document.getElementById("btnDraw");
  const loadingEl = document.getElementById("loading");
  const todayCountText = document.getElementById("todayCountText");

  const regionButtons = {
    all: document.getElementById("btnAll"),
    north: document.getElementById("btnNorth"),
    central: document.getElementById("btnCentral"),
    south: document.getElementById("btnSouth"),
    east: document.getElementById("btnEast"),
    islands: document.getElementById("btnIslands")
  };

  const targetChips = document.querySelectorAll(".target-chip");
  const dayMinus = document.getElementById("dayMinus");
  const dayPlus  = document.getElementById("dayPlus");
  const dayValue = document.getElementById("dayValue");

  const resultCard   = document.getElementById("resultCard");
  const resultTitle  = document.getElementById("resultTitle");
  const resultRegion = document.getElementById("resultRegion");
  const resultDesc   = document.getElementById("resultDesc");
  const resultExtra  = document.getElementById("resultExtra");
  const resultBear   = document.getElementById("resultBear");

  const btnHistory = document.getElementById("btnHistory");
  const modalHistory = document.getElementById("modalHistory");
  const historyList = document.getElementById("historyList");
  const historyDetail = document.getElementById("historyDetail");

  // ======== Helperï¼šæ—¥æœŸ ========
  function getTodayStr() {
    const d = new Date();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${d.getFullYear()}-${m}-${day}`;
  }

  // ======== åˆå§‹åŒ– localStorage ========
  function loadCounts() {
    try {
      const raw = localStorage.getItem(STORAGE_COUNTS);
      if (raw) {
        const obj = JSON.parse(raw);
        if (obj.date === getTodayStr()) {
          todayCounts = obj;
        }
      }
    } catch(e) {}
    updateCountsText();
  }

  function saveCounts() {
    todayCounts.date = getTodayStr();
    localStorage.setItem(STORAGE_COUNTS, JSON.stringify(todayCounts));
  }

  function updateCountsText() {
    todayCountText.textContent =
      `ä»Šæ—¥æ—…éŠç±¤ï¼š${todayCounts.travel} æ¬¡ã€€ï½œã€€ä»Šæ—¥ç¾é£Ÿç±¤ï¼š${todayCounts.food} æ¬¡`;
  }

  function loadHistory() {
    try {
      const raw = localStorage.getItem(STORAGE_HISTORY);
      if (raw) history = JSON.parse(raw);
    } catch(e) {
      history = [];
    }
  }

  function saveHistory() {
    localStorage.setItem(STORAGE_HISTORY, JSON.stringify(history));
  }

  // ======== å°æç¤ºé»æ“Š ========
  hintBtn.addEventListener("click", () => {
    const msg = hints[Math.floor(Math.random()*hints.length)];
    hintTextEl.textContent = msg;
  });

  // ======== åˆ†é åˆ‡æ› ========
  function setTab(tab) {
    currentTab = tab;
    if (tab === "travel") {
      tabTravel.classList.add("active");
      tabFood.classList.remove("active");
      btnDraw.textContent = "æŠ½æ—…éŠç±¤ âœ¨";
    } else {
      tabFood.classList.add("active");
      tabTravel.classList.remove("active");
      btnDraw.textContent = "æŠ½ç¾é£Ÿç±¤ ğŸ´";
    }
  }
  tabTravel.addEventListener("click", () => setTab("travel"));
  tabFood.addEventListener("click", () => setTab("food"));

  // ======== åœ°å€åˆ‡æ› ========
  function setRegion(key) {
    currentRegion = key;
    Object.entries(regionButtons).forEach(([k, btn]) => {
      if (!btn) return;
      if (k === key) btn.classList.add("active");
      else btn.classList.remove("active");
    });
  }
  Object.entries(regionButtons).forEach(([key, btn]) => {
    if (!btn) return;
    btn.addEventListener("click", () => setRegion(key));
  });

  // ======== å‡ºéŠå°è±¡ ========
  targetChips.forEach(chip => {
    chip.addEventListener("click", () => {
      targetChips.forEach(c => c.classList.remove("active"));
      chip.classList.add("active");
      currentTarget = chip.dataset.target;
    });
  });

  // ======== å¤©æ•¸ +/- ========
  function updateDayDisplay() {
    dayValue.textContent = currentDays;
  }
  dayMinus.addEventListener("click", () => {
    if (currentDays > 1) {
      currentDays--;
      updateDayDisplay();
    }
  });
  dayPlus.addEventListener("click", () => {
    if (currentDays < 5) {
      currentDays++;
      updateDayDisplay();
    }
  });

  // ======== æŠ½ç±¤é‚è¼¯ ========
  function drawTravel() {
    let list = travelSpots.filter(s => {
      // ç¯©åœ°å€
      if (currentRegion !== "all" && s.regionKey !== currentRegion) return false;
      // ç¯©å¤©æ•¸
      if (currentDays < s.daysMin || currentDays > s.daysMax) return false;
      // ç¯©å‡ºéŠå°è±¡
      if (currentTarget !== "ä¸é™" && !s.targets.includes(currentTarget)) return false;
      return true;
    });

    if (!list.length) {
      // è‹¥æ²’æœ‰ç¬¦åˆæ¢ä»¶ï¼Œå°±æ”¾å¯¬æ¢ä»¶åªçœ‹åœ°å€
      list = travelSpots.filter(s => currentRegion === "all" || s.regionKey === currentRegion);
    }
    if (!list.length) list = travelSpots;

    const picked = list[Math.floor(Math.random()*list.length)];

    resultCard.style.display = "block";
    resultTitle.textContent = picked.name;
    resultRegion.textContent = `å»ºè­°åœ°å€ï¼š${picked.region}ï½œé©åˆå¤©æ•¸ï¼šç´„ ${picked.daysMin}â€“${picked.daysMax} å¤©ï½œæ¨è–¦å°è±¡ï¼š${picked.targets.join("ã€")}`;
    resultDesc.textContent = picked.desc;
    resultExtra.textContent = picked.extra;
    resultBear.textContent = picked.bear;

    // è¨ˆæ•¸ & ç´€éŒ„
    todayCounts.travel++;
    updateCountsText();
    saveCounts();

    history.unshift({
      time: new Date().toISOString(),
      type: "æ—…éŠç±¤",
      data: {
        title: picked.name,
        region: picked.region,
        desc: picked.desc,
        extra: picked.extra,
        bear: picked.bear
      }
    });
    if (history.length > 100) history.pop();
    saveHistory();
  }

  function drawFood() {
    let list = foodSpots.filter(f => {
      if (currentRegion === "all") return true;
      return f.regionKey === currentRegion || f.regionKey === "all";
    });
    if (!list.length) list = foodSpots;

    const picked = list[Math.floor(Math.random()*list.length)];

    resultCard.style.display = "block";
    resultTitle.textContent = picked.name;
    resultRegion.textContent = `å»ºè­°åœ°å€ï¼š${picked.region}`;
    resultDesc.textContent = picked.desc;
    resultExtra.textContent = picked.extra;
    resultBear.textContent = picked.bear;

    todayCounts.food++;
    updateCountsText();
    saveCounts();

    history.unshift({
      time: new Date().toISOString(),
      type: "ç¾é£Ÿç±¤",
      data: {
        title: picked.name,
        region: picked.region,
        desc: picked.desc,
        extra: picked.extra,
        bear: picked.bear
      }
    });
    if (history.length > 100) history.pop();
    saveHistory();
  }

  btnDraw.addEventListener("click", () => {
    // æŠ½ç±¤ç­‰å¾…å‹•ç•«
    loadingEl.style.display = "flex";
    btnDraw.disabled = true;

    setTimeout(() => {
      loadingEl.style.display = "none";
      btnDraw.disabled = false;
      if (currentTab === "travel") drawTravel();
      else drawFood();
    }, 800);
  });

  // ======== ç´€éŒ„ Modal ========
  function openHistory() {
    historyList.innerHTML = "";
    historyDetail.style.display = "none";
    historyDetail.innerHTML = "";

    if (!history.length) {
      historyList.innerHTML = '<p style="font-size:13px;color:#7a4329;">ç›®å‰é‚„æ²’æœ‰ç´€éŒ„ï¼Œå…ˆä¾†æŠ½ä¸€ç±¤å§ï½</p>';
    } else {
      history.slice(0,40).forEach((item, idx) => {
        const d = new Date(item.time);
        const div = document.createElement("div");
        div.className = "history-item";
        div.dataset.index = idx;
        div.innerHTML = `
          <div class="history-title">ã€${item.type}ã€‘${item.data.title}</div>
          <div class="history-meta">${d.toLocaleString("zh-TW",{hour12:false})}ï½œåœ°å€ï¼š${item.data.region}</div>
        `;
        historyList.appendChild(div);
      });
    }
    modalHistory.classList.add("show");
  }

  function closeHistory() {
    modalHistory.classList.remove("show");
  }
  window.closeHistory = closeHistory;

  btnHistory.addEventListener("click", openHistory);

  // é»é¸ç´€éŒ„ â†’ é¡¯ç¤ºè©³ç´°å…§å®¹
  historyList.addEventListener("click", (e) => {
    const itemEl = e.target.closest(".history-item");
    if (!itemEl) return;
    const idx = parseInt(itemEl.dataset.index, 10);
    const item = history[idx];
    if (!item) return;
    historyDetail.style.display = "block";
    historyDetail.innerHTML = `
      <div style="font-weight:600;margin-bottom:4px;">ã€${item.type}ã€‘${item.data.title}</div>
      <div style="font-size:12px;color:#b07a50;margin-bottom:4px;">åœ°å€ï¼š${item.data.region}</div>
      <div style="margin-bottom:4px;">${item.data.desc}</div>
      <div style="font-size:12px;color:#b07a50;margin-bottom:4px;">${item.data.extra}</div>
      <div style="margin-top:4px;white-space:pre-line;">${item.data.bear}</div>
    `;
  });

  // é»èƒŒæ™¯é—œé–‰
  modalHistory.addEventListener("click", (e) => {
    if (e.target === modalHistory) closeHistory();
  });

  // ======== åˆå§‹åŒ– ========
  setTab("travel");
  setRegion("all");
  updateDayDisplay();
  loadCounts();
  loadHistory();
</script>
</body>
</html>