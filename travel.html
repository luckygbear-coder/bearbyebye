<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ä¸€è¶Ÿèªªèµ°å°±èµ°çš„æ—…è¡Œï½â¤ï¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* ========= åŸºæœ¬è¨­å®š ========= */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      background: #ffb54b;
      font-family: "Noto Sans TC", -apple-system, BlinkMacSystemFont, sans-serif;
      overflow: hidden; /* ä¸€é å¼ä¸æ»‘å‹• */
    }
    .app-wrap {
      max-width: 480px;
      height: 100vh;
      margin: 0 auto;
      background: #ffeec9;
      padding: 6px 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }

    /* ========= Header ========= */
    .header {
      text-align: center;
      flex-shrink: 0;
    }
    .header h1 {
      margin: 2px 0 0 0;
      font-size: 20px;
      color: #7a4329;
    }
    .header p {
      margin: 2px 0 0 0;
      font-size: 12px;
      color: #9b5b36;
    }

    /* ========= å¤§åœ–å€ ========= */
    .travel-hero-card {
      margin-top: 4px;
      background: #ffe3b1;
      border-radius: 20px;
      padding: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.16);
      position: relative;
      flex-shrink: 0;
    }
    .travel-hero-img {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
    }
    .travel-hero-img img {
      width: 100%;
      height: auto;
      display: block;
      max-height: 300px; /* å¤§åœ–æ¯”ä¾‹è‡ªé©æ‡‰ï¼Œä¸Šé™é¿å…éé«˜ */
    }

    /* ========= åœ°å€æŒ‰éˆ• ========= */
    .region-chip {
      position: absolute;
      padding: 6px 16px;
      font-size: 14px;
      border-radius: 999px;
      border: 1.5px solid #f5d1a8;
      background: rgba(255, 250, 242, 0.9);
      color: #7a4329;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      backdrop-filter: blur(2px);
    }
    .region-chip.active {
      background: rgba(255,207,152,0.95);
      border-color: #f0a96b;
    }
    .region-chip:active {
      transform: scale(0.95);
    }

    /* ä½ç½®å¾®èª¿ï¼ˆé¿é–‹å¤ªé™½ / 101 / ç†Š / è¡Œæç®±ï¼‰ */
    .chip-all     { top: 20%; left: 18%; }
    .chip-north   { top: 10%; right: 18%; }
    .chip-central { top: 38%; right: 24%; }
    .chip-south   { top: 66%; right: 22%; }
    .chip-east    { top: 30%; right: 6%; }
    .chip-islands { top: 70%; left: 4%; }

    /* ========= IG æŒ‰éˆ• ========= */
    .ig-btn {
      position: absolute;
      right: 8px;
      bottom: 6px;
      background: #fff5de;
      border: 1.5px solid #f0c57a;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      color: #7a4329;
      text-decoration: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    /* ========= å‡ºéŠç†Šå°èª ========= */
    .bear-talk-bubble {
      position: absolute;
      top: 6px;
      right: 10px;
      max-width: 60%;
      background: #fffaf2;
      padding: 6px 8px;
      border-radius: 14px;
      border: 1.5px solid #f5d1a8;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      font-size: 12px;
      color: #7a4329;
      display: none;
    }

    /* ========= æ¬¡æ¨™é¡Œ ========= */
    .section-title {
      margin-top: 4px;
      text-align: center;
    }
    .section-title h2 {
      margin: 0;
      font-size: 18px;
      color: #7a4329;
    }
    .section-title p {
      margin: 2px 0 0;
      font-size: 12px;
      color: #9b5b36;
    }

    /* ========= åˆ†é åˆ‡æ›ï¼ˆå»å“ªç© / åƒä»€éº¼ï¼‰ ========= */
    .tab-row {
      margin-top: 4px;
      display: flex;
      background: #ffe3b1;
      padding: 2px;
      border-radius: 999px;
    }
    .tab-btn {
      flex: 1;
      background: transparent;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      padding: 6px;
      color: #9b5b36;
      cursor: pointer;
    }
    .tab-btn.active {
      background: #fffaf2;
      color: #7a4329;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    /* ========= é¸æ“‡å‡ºéŠå°è±¡ + å¤©æ•¸ ========= */
    .options-row {
      margin-top: 4px;
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }
    .option-block {
      flex: 1;
      background: #fffaf2;
      border-radius: 14px;
      padding: 6px 8px;
      border: 1.5px solid #f5d1a8;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    .option-title {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 4px;
      color: #7a4329;
    }

    .target-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    .target-chip {
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 11px;
      background: #fff;
      border: 1.5px solid #f5d1a8;
      color: #7a4329;
      cursor: pointer;
    }
    .target-chip.active {
      background: #ffcf98;
      border-color: #f0a96b;
    }

    .day-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .day-btn {
      width: 24px;
      height: 24px;
      background: #fff;
      border-radius: 50%;
      border: 1.5px solid #f5d1a8;
      cursor: pointer;
      font-size: 15px;
      color: #7a4329;
    }
    .day-value {
      width: 26px;
      text-align: center;
      font-size: 14px;
      color: #7a4329;
    }
    .day-note {
      margin-top: 3px;
      font-size: 10px;
      color: #b07a50;
    }

    /* ========= æŠ½ç±¤æŒ‰éˆ•å€ ========= */
    .bottom-area {
      margin-top: 4px;
      flex-shrink: 0;
    }
    .btn-row {
      display: flex;
      gap: 6px;
    }
    .btn-draw {
      flex: 1.3;
      border: none;
      background: linear-gradient(90deg,#ffb46f,#ff8f6b);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: bold;
      color: #7a4329;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }
    .btn-record {
      flex: 0.9;
      border-radius: 999px;
      border: 1.5px dashed #f0a96b;
      background: #fffaf2;
      padding: 7px 8px;
      font-size: 12px;
      color: #7a4329;
      cursor: pointer;
    }

    .loading {
      margin-top: 4px;
      font-size: 11px;
      color: #9b5b36;
      display: none;
      align-items: center;
      gap: 3px;
    }
    .loading .dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #f0a96b;
      animation: blink 0.9s infinite alternate;
    }
    .loading .dot:nth-child(2) { animation-delay: 0.2s; }
    .loading .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
      from { opacity: 0.2; transform: translateY(0); }
      to   { opacity: 1;   transform: translateY(-1px); }
    }

    .today-count {
      margin-top: 4px;
      font-size: 11px;
      color: #9b5b36;
    }

    /* ========= Modal å…±ç”¨ ========= */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-backdrop.show { display: flex; }

    .modal-window {
      width: 88%;
      max-width: 420px;
      max-height: 80vh;
      overflow-y: auto;
      background: #fff7e6;
      border-radius: 18px;
      border: 2px solid #f3c690;
      padding: 12px 16px;
      position: relative;
    }
    .modal-close {
      position: absolute;
      right: 10px;
      top: 6px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      color: #7a4329;
    }

    .modal-meta {
      font-size: 12px;
      color: #b07a50;
      white-space: pre-line;
    }
    .modal-bear {
      margin-top: 6px;
      font-size: 13px;
      color: #7a4329;
      white-space: pre-line;
    }

    .history-empty {
      font-size: 12px;
      color: #9b5b36;
    }
    .history-item {
      padding: 6px 4px;
      border-bottom: 1px dashed #f0c57a;
      cursor: pointer;
    }
    .history-title {
      font-size: 13px;
      color: #7a4329;
    }
    .history-meta {
      font-size: 11px;
      color: #b07a50;
    }
  </style>
</head>

<body>
  <div class="app-wrap">

    <header class="header">
      <h1>èªªèµ°å°±èµ°çš„æ—…è¡Œ</h1>
      <p>è®“å‡ºéŠç†Šé™ªä½ ä¸€èµ·åƒå–ç©æ¨‚â¤ï¸</p>
    </header>

    <!-- å¤§åœ– + åœ°å€æŒ‰éˆ• -->
    <section class="travel-hero-card">
      <div class="travel-hero-img">
        <img src="images/travel.png" alt="å‡ºéŠç†Šå»å“ªç©">

        <button class="region-chip chip-all active" id="btnAll">å…¨å°</button>
        <button class="region-chip chip-north" id="btnNorth">åŒ—éƒ¨</button>
        <button class="region-chip chip-central" id="btnCentral">ä¸­éƒ¨</button>
        <button class="region-chip chip-south" id="btnSouth">å—éƒ¨</button>
        <button class="region-chip chip-east" id="btnEast">æ±éƒ¨</button>
        <button class="region-chip chip-islands" id="btnIslands">å¤–å³¶</button>
      </div>

      <div class="bear-talk-bubble" id="bearTalk"></div>

      <a href="https://instagram.com/luckygbear" target="_blank" class="ig-btn">
        ğŸ“· å‡ºéŠç†Š IG
      </a>
    </section>

    <section class="section-title">
      <h2>å»å“ªç©åƒä»€éº¼</h2>
      <p>é¸åœ°åœ–ä¸Šçš„åœ°é»ï¼Œå†æ­é…å‡ºéŠå°è±¡èˆ‡å¤©æ•¸ï¼Œè®“å‡ºéŠç†Šå¹«ä½ æŠ½ç±¤ï½</p>
    </section>

    <!-- åˆ†é åˆ‡æ› -->
    <div class="tab-row">
      <button class="tab-btn active" id="tabTravel">å»å“ªç©</button>
      <button class="tab-btn" id="tabFood">åƒä»€éº¼</button>
    </div>

    <!-- å‡ºéŠå°è±¡ + å¤©æ•¸ -->
    <div class="options-row">
      <div class="option-block">
        <div class="option-title">å‡ºéŠå°è±¡</div>
        <div class="target-chip-row">
          <button class="target-chip active" data-target="ä¸é™">ä¸é™</button>
          <button class="target-chip" data-target="è¦ªå­">è¦ªå­</button>
          <button class="target-chip" data-target="æƒ…ä¾¶">æƒ…ä¾¶</button>
          <button class="target-chip" data-target="å¤§äººæ”¾é¬†">å¤§äººæ”¾é¬†</button>
          <button class="target-chip" data-target="ä¸€å€‹äºº">ä¸€å€‹äºº</button>
        </div>
      </div>

      <div class="option-block">
        <div class="option-title">ç©å¹¾å¤©</div>
        <div class="day-row">
          <button class="day-btn" id="dayMinus">-</button>
          <div class="day-value" id="dayValue">2</div>
          <button class="day-btn" id="dayPlus">+</button>
        </div>
        <div class="day-note">(1â€“5 å¤©ï¼Œå°æ—…è¡Œæœ€å‰›å¥½)</div>
      </div>
    </div>

    <!-- æŠ½ç±¤æŒ‰éˆ• -->
    <div class="bottom-area">
      <div class="btn-row">
        <button class="btn-draw" id="btnDraw">æŠ½æ—…éŠç±¤ âœ¨</button>
        <button class="btn-record" id="btnHistory">æŸ¥çœ‹ç´€éŒ„ ğŸ“š</button>
      </div>

      <div class="loading" id="loading">
        å‡ºéŠç†Šå¹«ä½ æŠ½ç±¤ä¸­â€¦
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>

      <div class="today-count" id="todayCountText">
        ä»Šæ—¥æ—…éŠç±¤ï¼š0 æ¬¡ ï½œ ä»Šæ—¥ç¾é£Ÿç±¤ï¼š0 æ¬¡
      </div>
    </div>

  </div>

  <!-- æŠ½ç±¤çµæœ Modal -->
  <div class="modal-backdrop" id="modalResult">
    <div class="modal-window">
      <button class="modal-close" onclick="closeResult()">âœ•</button>
      <h3 id="modalResultTitle"></h3>
      <p class="modal-meta" id="modalResultMeta"></p>
      <p id="modalResultDesc"></p>
      <p class="modal-meta" id="modalResultExtra"></p>
      <p class="modal-bear" id="modalResultBear"></p>
    </div>
  </div>

  <!-- ç´€éŒ„ Modal -->
  <div class="modal-backdrop" id="modalHistory">
    <div class="modal-window">
      <button class="modal-close" onclick="closeHistory()">âœ•</button>
      <h3>å‡ºéŠèˆ‡ç¾é£Ÿç´€éŒ„</h3>
      <p style="font-size:12px;color:#b07a50;margin-bottom:6px;">
        é»é¸ä¸€ç­†ç´€éŒ„ï¼Œå¯ä»¥é‡æ–°æŸ¥çœ‹å…§å®¹ã€‚
      </p>
      <div id="historyList"></div>
    </div>
  </div>

  <!-- ===================== JS ===================== -->
  <script>
    /* ========= å‡ºéŠç†Šå°èª ========= */
    const bearTalkList = [
      "å‡ºç™¼å§ï¼ä»Šå¤©çš„é¢¨æ™¯æº–å‚™å¥½è¿æ¥ä½ äº†ï½",
      "ç©å¾—é–‹å¿ƒæœ€é‡è¦ï¼Œä¸ç”¨æŠŠè¡Œç¨‹å¡æ»¿å–”ï¼",
      "å¿ƒæƒ…æ±ºå®šæ—…è¡Œçš„å‘³é“ï¼Œä»Šå¤©æƒ³æ”¾é¬†é‚„æ˜¯æ¢éšªï¼Ÿ",
      "ä¿æŒå½ˆæ€§ï¼Œå¸¸å¸¸æœƒé‡åˆ°æ„å¤–çš„ç¾å¥½ï½",
      "æ—…è¡Œå°±æ˜¯çµ¦å¿ƒä¸€å€‹æ”¾å‡çš„ç†ç”± ğŸŒ¿",
      "ä¸ä¸€å®šè¦èµ°é ï¼Œåªè¦é¡˜æ„å‡ºç™¼å°±æ˜¯æ—…è¡Œã€‚",
      "è¨˜å¾—è£œå……æ°´åˆ†å–”ï¼å¿«æ¨‚è¦æŒä¹…æ‰è¡Œï½",
      "ä»Šå¤©ï¼Œå°±è®“å‡ºéŠç†Šå¸¶ä½ çœ‹çœ‹ä¸ä¸€æ¨£çš„ä¸–ç•Œï¼"
    ];

    /* ========= ä½¿ç”¨è€…é¸æ“‡ç‹€æ…‹ ========= */
    let selectedRegion = "å…¨å°";
    let selectedTarget = "ä¸é™";
    let selectedDays   = 2;

    /* ä»Šå¤©å·²æŠ½æ¬¡æ•¸ */
    let todayTravelCount = 0;
    let todayFoodCount   = 0;

    /* æŠ“ DOM */
    const bearTalk       = document.getElementById("bearTalk");
    const dayValue       = document.getElementById("dayValue");
    const todayCountText = document.getElementById("todayCountText");

    const modalResult  = document.getElementById("modalResult");
    const modalHistory = document.getElementById("modalHistory");
    const historyList  = document.getElementById("historyList");

    // åœ°å€æŒ‰éˆ•
    document.querySelectorAll(".region-chip").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".region-chip").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        selectedRegion = btn.innerText;
      });
    });

    // å‡ºéŠå°è±¡
    document.querySelectorAll(".target-chip").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".target-chip").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        selectedTarget = btn.dataset.target;
      });
    });

    // å¤©æ•¸åŠ æ¸›
    document.getElementById("dayMinus").addEventListener("click", () => {
      if (selectedDays > 1) selectedDays--;
      dayValue.innerText = selectedDays;
    });
    document.getElementById("dayPlus").addEventListener("click", () => {
      if (selectedDays < 5) selectedDays++;
      dayValue.innerText = selectedDays;
    });

    // æ›´æ–°ä»Šæ—¥æŠ½ç±¤æ¬¡æ•¸
    function updateCounts() {
      todayCountText.innerHTML =
        `ä»Šæ—¥æ—…éŠç±¤ï¼š${todayTravelCount} æ¬¡ ï½œ ä»Šæ—¥ç¾é£Ÿç±¤ï¼š${todayFoodCount} æ¬¡`;
    }

    // é¡¯ç¤ºå‡ºéŠç†Šéš¨æ©Ÿå°èª
    function showBearTalk() {
      const msg = bearTalkList[Math.floor(Math.random() * bearTalkList.length)];
      bearTalk.innerText = msg;
      bearTalk.style.display = "block";
      setTimeout(() => { bearTalk.style.display = "none"; }, 2200);
    }

    // é–‹å•Ÿ/é—œé–‰ modal
    function openModal(el) { el.classList.add("show"); }
    function closeResult() { modalResult.classList.remove("show"); }
    function closeHistory(){ modalHistory.classList.remove("show"); }

    /* ====== æ—…éŠæ™¯é» / ç¾é£Ÿç±¤ é™£åˆ— ====== */
    const travelSpots = [];
    const foodSpots   = [];

    /* ======= ä»¥ä¸‹ï¼šä½ çš„æ—…éŠæ™¯é»è³‡æ–™ï¼ˆåŒ—/ä¸­/å—/æ±/å¤–å³¶ï¼‰ ======= */
    /* --- æˆ‘ç›´æ¥ç”¨ä½ è²¼çš„å…§å®¹ä¿ç•™åŸæ¨£ï¼Œä¸å†é‡è¤‡è¨»è§£ --- */
    /* åŒ—éƒ¨ + ä¸­éƒ¨ + å—éƒ¨ + æ±éƒ¨ + å¤–å³¶ ...ï¼ˆé€™è£¡å°±æ˜¯ä½ åŸæœ¬çš„ travelSpots.push(...) å…¨éƒ¨ï¼‰ */

    /* ç‚ºäº†ä¸è¦å¤ªé•·ï¼Œæˆ‘å°±ä¸åœ¨é€™è£¡é‡è¤‡è²¼ï¼Œä½ åªè¦æŠŠä½ ä¸Šé¢é‚£ä¸€æ•´æ®µ
       travelSpots.push(...) å…¨éƒ¨ç•™åœ¨é€™è£¡å°±å¯ä»¥ï¼ˆä¸ç”¨æ”¹ï¼‰ */

    /* ======= ç¾é£Ÿç±¤ 50 ç¨® ======= */
    /* åŒç†ï¼Œé€™è£¡æ”¾ä½ æ‰€æœ‰çš„ foodSpots.push(...)ï¼Œç…§å‰›å‰›é‚£ä»½å°±å¥½ */

    // -------------- æŠ½ç±¤åŠŸèƒ½ & ç´€éŒ„ï¼ˆåŸç¬¬ 6 / 6 æ®µï¼‰ --------------

    const btnDraw      = document.getElementById("btnDraw");
    const btnHistory   = document.getElementById("btnHistory");
    const loadingEl    = document.getElementById("loading") || { style: {} };

    const tabTravel    = document.getElementById("tabTravel");
    const tabFood      = document.getElementById("tabFood");

    const modalResultTitle = document.getElementById("modalResultTitle");
    const modalResultMeta  = document.getElementById("modalResultMeta");
    const modalResultDesc  = document.getElementById("modalResultDesc");
    const modalResultExtra = document.getElementById("modalResultExtra");
    const modalResultBear  = document.getElementById("modalResultBear");

    let currentTab = "travel"; // travel or food
    let historyRecords = [];

    // å–å¾—ä»Šå¤©æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
    function getTodayStr() {
      return new Date().toISOString().slice(0, 10);
    }

    // è¼‰å…¥æ­·å²ç´€éŒ„ & ä»Šæ—¥æ¬¡æ•¸
    function loadHistory() {
      const raw = localStorage.getItem("travelFoodHistory");
      historyRecords = raw ? JSON.parse(raw) : [];

      const todayStr = getTodayStr();
      todayTravelCount = 0;
      todayFoodCount = 0;

      historyRecords.forEach(r => {
        if (r.date === todayStr) {
          if (r.type === "æ—…éŠ") todayTravelCount++;
          if (r.type === "ç¾é£Ÿ") todayFoodCount++;
        }
      });

      updateCounts();
    }

    function saveHistory() {
      const trimmed = historyRecords.slice(0, 80);
      localStorage.setItem("travelFoodHistory", JSON.stringify(trimmed));
    }

    function addHistory(record) {
      historyRecords.unshift(record);
      saveHistory();
    }

    function renderHistoryList() {
      if (!historyRecords.length) {
        historyList.innerHTML =
          '<div class="history-empty">ç›®å‰é‚„æ²’æœ‰ç´€éŒ„å”·ï½å¯ä»¥å…ˆæŠ½ä¸€å¼µç±¤çœ‹çœ‹ ğŸ»</div>';
        return;
      }

      historyList.innerHTML = historyRecords
        .map((r, idx) => {
          const regionPart = r.region ? `ï½œåœ°å€ï¼š${r.region}` : "";
          return `
            <div class="history-item" data-idx="${idx}">
              <div class="history-title">[${r.type}] ${r.title}</div>
              <div class="history-meta">${r.date}${regionPart}</div>
            </div>
          `;
        })
        .join("");
    }

    historyList.addEventListener("click", (e) => {
      const item = e.target.closest(".history-item");
      if (!item) return;
      const idx = Number(item.dataset.idx);
      const r = historyRecords[idx];
      if (!r) return;

      modalResultTitle.textContent = r.title;
      modalResultMeta.textContent  = r.meta;
      modalResultDesc.textContent  = r.desc;
      modalResultExtra.textContent = r.extra;
      modalResultBear.textContent  = r.bear;

      openModal(modalResult);
    });

    function setTab(tab) {
      currentTab = tab;
      if (tab === "travel") {
        tabTravel.classList.add("active");
        tabFood.classList.remove("active");
        btnDraw.textContent = "æŠ½æ—…éŠç±¤ âœ¨";
      } else {
        tabFood.classList.add("active");
        tabTravel.classList.remove("active");
        btnDraw.textContent = "æŠ½ç¾é£Ÿç±¤ ğŸ™";
      }
    }

    tabTravel.addEventListener("click", () => setTab("travel"));
    tabFood.addEventListener("click", () => setTab("food"));

    function drawTravel() {
      if (!travelSpots.length) {
        alert("æ—…éŠè³‡æ–™é‚„åœ¨è·¯ä¸Šï¼Œç­‰ç­‰å†è©¦ä¸€æ¬¡ï½");
        return;
      }

      showBearTalk();
      if (loadingEl.style) loadingEl.style.display = "flex";

      setTimeout(() => {
        if (loadingEl.style) loadingEl.style.display = "none";

        let pool = travelSpots;
        if (selectedRegion !== "å…¨å°") {
          const filtered = travelSpots.filter(s => s.region === selectedRegion);
          if (filtered.length) pool = filtered;
        }

        const spot = pool[Math.floor(Math.random() * pool.length)];
        const todayStr = getTodayStr();
        todayTravelCount++;
        updateCounts();

        const meta  = `åœ°å€ï¼š${spot.region}ï½œå‡ºéŠå°è±¡ï¼š${selectedTarget}ï½œå¤©æ•¸ï¼š${selectedDays} å¤©`;
        const extra = `å»ºè­°ç©æ³•ï¼š${spot.suggest}\næ¨è–¦ç¾é£Ÿï¼š${spot.food}`;
        const bear  = `ğŸ» ç†Šç†Šèªªï¼š${spot.bear}`;

        modalResultTitle.textContent = spot.title;
        modalResultMeta.textContent  = meta;
        modalResultDesc.textContent  = spot.desc;
        modalResultExtra.textContent = extra;
        modalResultBear.textContent  = bear;

        openModal(modalResult);

        addHistory({
          type: "æ—…éŠ",
          date: todayStr,
          title: spot.title,
          region: spot.region,
          meta,
          desc: spot.desc,
          extra,
          bear
        });
      }, 900);
    }

    function drawFood() {
      if (!foodSpots.length) {
        alert("ç¾é£Ÿè³‡æ–™é‚„åœ¨çƒ¹ç…®ä¸­ï¼Œç­‰ç­‰å†è©¦ä¸€æ¬¡ï½");
        return;
      }

      showBearTalk();
      if (loadingEl.style) loadingEl.style.display = "flex";

      setTimeout(() => {
        if (loadingEl.style) loadingEl.style.display = "none";

        const food = foodSpots[Math.floor(Math.random() * foodSpots.length)];
        const todayStr = getTodayStr();
        todayFoodCount++;
        updateCounts();

        const meta  = `ç†±é‡ï¼šç´„ ${food.kcal} å¤§å¡ï½œå»ºè­°é‹å‹•ï¼šç´„ ${food.sport} åˆ†é˜`;
        const extra = `ç¾é£Ÿç±¤è§£èªªï¼š${food.explain}`;
        const bear  = `ğŸ» ç†Šç†Šæé†’ï¼š${food.bear}`;

        modalResultTitle.textContent = `ã€ç¾é£Ÿç±¤ã€‘${food.title}`;
        modalResultMeta.textContent  = meta;
        modalResultDesc.textContent  = food.desc;
        modalResultExtra.textContent = extra;
        modalResultBear.textContent  = bear;

        openModal(modalResult);

        addHistory({
          type: "ç¾é£Ÿ",
          date: todayStr,
          title: food.title,
          region: "",
          meta,
          desc: food.desc,
          extra,
          bear
        });
      }, 900);
    }

    btnDraw.addEventListener("click", () => {
      if (currentTab === "travel") drawTravel();
      else drawFood();
    });

    btnHistory.addEventListener("click", () => {
      renderHistoryList();
      openModal(modalHistory);
    });

    [modalResult, modalHistory].forEach(backdrop => {
      backdrop.addEventListener("click", (e) => {
        if (e.target === backdrop) backdrop.classList.remove("show");
      });
    });

    // åˆå§‹åŒ–
    setTab("travel");
    loadHistory();
    updateCounts();
  </script>
</body>
</html>